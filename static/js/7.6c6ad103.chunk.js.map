{"version":3,"sources":["components/Survey.module.css","components/Question.module.css","components/GeoInput.module.css","hooks/useKeyPress.js","functions/computeHasValue.js","components/GeoInput.js","components/Question.js","questions.yaml","components/Survey.js"],"names":["module","exports","useKeyPress","keys","callback","useEffect","onKeyup","event","includes","key","window","addEventListener","removeEventListener","computeHasValue","value","hasValue","Set","size","Array","isArray","length","String","isNaN","Object","MapScale","map","useMap","L","control","scale","addTo","MapSearch","withLocalization","getString","useState","typingTimeout","setTypingTimeout","provider","setProvider","OpenStreetMapProvider","params","email","handleChange","useCallback","clearTimeout","setTimeout","search","query","target","then","result","fitBounds","bounds","className","classes","searchInput","type","onChange","placeholder","MapZoom","handleZoomIn","zoomIn","handleZoomOut","zoomOut","zoomButtonsWrapper","zoomButton","onClick","MapEventHandler","onMap","useMapEvent","geoPrecision","geoShift","GeoInput","defaultValue","setMap","defaultValueLatLng","split","parseFloat","lat","lng","markerPos","setMarkerPos","preciseMarkerPos","setPreciseMarkerPos","rectangle","useRectangle","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","handleMapClick","latlng","roundedLat","Math","round","roundedLng","handleMap","newMap","mapWrapper","MapContainer","center","zoom","scrollWheelZoom","zoomControl","TileLayer","attribution","url","Circle","radius","pathOptions","fillOpacity","color","Rectangle","fillColor","weight","lineCap","lineJoin","abc","ABC","toUpperCase","keys2listen","fluentByObject","_id","question","description","input","defaultValueObject","onSubmit","inputRef","useRef","firstDefaultValue","writeInDefaultValue","write_in","setValue","writeInValue","setWriteInValue","JSON","stringify","setValueJSON","setValueBoth","newValue","writeInIsActive","setWriteInIsActive","current","blur","required","index","indexOf","options","option","multiple","has","delete","add","oldValue","storeValue","newValueSet","storeGeoValue","storeWriteInValue","handleWriteInFocus","handleWriteInBlur","handleChoiceClick","handleSubmit","focus","input_component","ref","min","onFocus","onBlur","thisOption","title","style","whiteSpace","display","marginBottom","button_key","margin","verticalAlign","fontWeight","fill","filter","Boolean","line","Localized","id","elems","strong","submit_incident","gql","getValueTitle","de","Survey","uploaded","setUploaded","questions","setQuestions","questionsById","setQuestionsById","answers","setAnswers","currentQuestionsIndex","setCurrentQuestionsIndex","useMutation","onCompleted","onError","error","console","submitIncident","mutationLoading","loading","mutationError","a","fetch","questions_path","response","text","data","yaml","load","dataForArray","parse","dataForObject","entries","questionEntry","thisQuestionData","optionsEntry","reduce","obj","load_data","prevQuestion","nextQuestion","toTheBeginning","gotoFirstQuestion","nodeName","handleSendData","answersForSending","values","answer","warn","thisQuestion","variables","properties","ignoreResults","handleDownloadData","answersForDownload","now","Date","toISOString","nowForFilename","replace","textToWrite","fileNameToSaveAs","textFileAsBlob","Blob","downloadLink","document","createElement","download","innerHTML","webkitURL","href","createObjectURL","URL","onclick","parentNode","removeChild","body","appendChild","click","saveTextAsFile","thisValue","join","currentQuestion","answersArray","survey","progress","opacity","content","contentWrapper","rel","actions","disabled"],"mappings":"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","file":"static/js/7.6c6ad103.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"survey\":\"Survey_survey__3pPR3\",\"progress\":\"Survey_progress__1lvcc\",\"content\":\"Survey_content__2w_sB\",\"contentWrapper\":\"Survey_contentWrapper__380v2\",\"actions\":\"Survey_actions__Qs2yy\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"question\":\"Question_question__1iSNS\",\"button_key\":\"Question_button_key__1i8i4\",\"option\":\"Question_option__3f0DC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"mapWrapper\":\"GeoInput_mapWrapper__3HwMS\",\"map\":\"GeoInput_map__3L-Nl\",\"searchInput\":\"GeoInput_searchInput__1aYZ2\",\"zoomButtonsWrapper\":\"GeoInput_zoomButtonsWrapper__Nxaw_\",\"zoomButton\":\"GeoInput_zoomButton__n1Agi\"};","import { useEffect } from 'react'\n\nexport default function useKeyPress(keys, callback) {\n  useEffect(() => {\n    function onKeyup(event) {\n      if (keys.includes(event.key)) {\n        callback(event)\n      }\n    }\n    window.addEventListener('keyup', onKeyup)\n    return () => window.removeEventListener('keyup', onKeyup)\n  }, [keys, callback])\n}\n","export default function computeHasValue(value) {\n  let hasValue = false\n  if (typeof value === 'object' && value instanceof Set && value.size > 0) {\n    hasValue = true\n  } else if (Array.isArray(value) && value.length > 0) {\n    hasValue = true\n  } else if ((typeof value === 'string' || value instanceof String) && value.length > 0) {\n    hasValue = true\n  } else if (typeof value === 'number' && !isNaN(value)) {\n    hasValue = true\n  } else if (typeof value === 'object' && value !== null && Object.keys(value).length > 0) {\n    hasValue = true\n  }\n  return hasValue\n}\n","import { useState, useEffect, useCallback } from 'react'\n\nimport { IonButton } from '@ionic/react'\n\nimport { withLocalization } from '../Localized.js'\n\nimport { MapContainer, TileLayer, Circle, Rectangle, useMapEvent, useMap } from 'react-leaflet'\nimport 'leaflet/dist/leaflet.css'\n\nimport { OpenStreetMapProvider } from 'leaflet-geosearch'\n\nimport classes from './GeoInput.module.css'\nimport './GeoInputLeaflet.css'\n\nimport iconRetinaUrl from 'leaflet/dist/images/marker-icon-2x.png'\nimport iconUrl from 'leaflet/dist/images/marker-icon.png'\nimport shadowUrl from 'leaflet/dist/images/marker-shadow.png'\n\nfunction MapScale() {\n  const map = useMap()\n\n  useEffect(() => {\n    window.L.control.scale().addTo(map)\n  }, [map])\n\n  return null\n}\n\nfunction MapSearchTemp({ getString, map }) {\n  const [typingTimeout, setTypingTimeout] = useState()\n\n  const [provider, setProvider] = useState()\n\n  useEffect(() => {\n    setProvider(new OpenStreetMapProvider({ // TODO: Add more providers as a backup. And propably proxy through our api server.\n      params: {\n        email: 'tech@queerfeindlichkeit.de', // auth for large number of requests\n      },\n    }))\n  }, [setProvider])\n\n  const handleChange = useCallback(event => {\n    clearTimeout(typingTimeout)\n    setTypingTimeout(setTimeout(()=>{\n      if (!!provider && !!map) {\n        provider.search({ query: event.target.value })\n          .then(function (result) {\n            if (result.length > 0) {\n              map.fitBounds(result[0].bounds)\n              // map.setView({ lng: result[0].x, lat: result[0].y })\n            }\n          })\n      }\n    }, 500))\n  }, [typingTimeout, setTypingTimeout, provider, map])\n\n  return <input\n    className={classes.searchInput}\n    type=\"text\"\n    onChange={handleChange}\n    placeholder={getString('placeholder_search')}\n  />\n}\nconst MapSearch = withLocalization(MapSearchTemp)\n\nfunction MapZoom({ map }) {\n  const handleZoomIn = useCallback(event => {\n    if (!!map) {\n      map.zoomIn(1)\n    }\n  }, [map])\n\n  const handleZoomOut = useCallback(event => {\n    if (!!map) {\n      map.zoomOut(1)\n    }\n  }, [map])\n\n  return <div className={classes.zoomButtonsWrapper}>\n    <IonButton className={classes.zoomButton} onClick={handleZoomIn}>+</IonButton>\n    <IonButton className={classes.zoomButton} onClick={handleZoomOut}>-</IonButton>\n  </div>\n}\n\nfunction MapEventHandler({ onMap, onClick }) {\n  const map = useMap()\n\n  useEffect(() => {\n    onMap(map)\n  }, [onMap, map])\n\n  useMapEvent('click', onClick)\n\n  return null\n}\n\nconst geoPrecision = 100\nconst geoShift = 0.5 / geoPrecision\n\nfunction useRectangle({ lat, lng }) {\n  return [\n    [lat - geoShift, lng - geoShift],\n    [lat + geoShift, lng + geoShift],\n  ]\n}\n\nfunction GeoInput({ onChange, defaultValue }) {\n  const [map, setMap] = useState()\n\n  const defaultValueLatLng = (defaultValue || '').split(',').map(value => parseFloat(value))\n\n  const [markerPos, setMarkerPos] = useState({ lat: defaultValueLatLng[0] || 0, lng: defaultValueLatLng[1] || 0 })\n  const [preciseMarkerPos, setPreciseMarkerPos] = useState(markerPos)\n  const rectangle = useRectangle(markerPos)\n\n  useEffect(() => {\n    const L = window.L\n\n    delete L.Icon.Default.prototype._getIconUrl\n\n    L.Icon.Default.mergeOptions({\n      iconRetinaUrl,\n      iconUrl,\n      shadowUrl\n    })\n  }, [])\n\n  const handleMapClick = useCallback((event) => {\n    // if (event.originalEvent.target.classList.contains('leaflet-container')) { // check if event is coming from the map\n      let { lat, lng } = event.latlng\n\n      let roundedLat = Math.round(lat * geoPrecision) / geoPrecision\n      let roundedLng = Math.round(lng * geoPrecision) / geoPrecision\n\n      if (roundedLat === markerPos.lat && roundedLng === markerPos.lng) {\n        roundedLat = 0\n        roundedLng = 0\n        lat = 0\n        lng = 0\n      }\n\n      setPreciseMarkerPos({ lat, lng })\n      setMarkerPos({ lat: roundedLat, lng: roundedLng })\n\n      if (roundedLat === 0 && roundedLng === 0) {\n        onChange(null)\n      } else {\n        onChange(`${roundedLat}, ${roundedLng}`)\n      }\n    // }\n  }, [markerPos, setPreciseMarkerPos, setMarkerPos, onChange])\n\n  const handleMap = useCallback((newMap) => {\n    setMap(newMap)\n  }, [setMap])\n\n  return <div className={classes.mapWrapper}>\n    <MapSearch map={map} />\n    <MapZoom map={map} />\n    <MapContainer\n      className={classes.map}\n      center={[51.2964955, 9.9019876]}\n      zoom={5.5}\n      scrollWheelZoom={false}\n      zoomControl={false}\n    >\n      {/* <TileLayer\n        attribution='© <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n      /> */}\n      {/* <TileLayer\n        attribution='© <a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\" rel=\"noreferrer\">OpenStreetMap</a> contributors | © <a href=\"https://carto.com/attributions\" target=\"_blank\" rel=\"noreferrer\">CARTO</a>'\n        url=\"https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png\"\n        subdomains=\"abcd\"\n        maxZoom={19}\n      /> */}\n      {/* <TileLayer\n        attribution='© <a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\" rel=\"noreferrer\">OpenStreetMap</a> contributors'\n        url=\"http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png\"\n        subdomains=\"ab\"\n        maxZoom={19}\n      /> */}\n      <TileLayer\n        attribution='<a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\" rel=\"noreferrer\">© OpenStreetMap</a> <a href=\"https://www.mapbox.com/about/maps/\" target=\"_blank\" rel=\"noreferrer\">© Mapbox</a>'\n        url=\"https://api.mapbox.com/styles/v1/qiekub/cko1ikam20wgq18p9wd200uy0/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoicWlla3ViIiwiYSI6ImNrbzFpY3NtZjA4dXQyb3M1OGU5czNqZzYifQ.UFFb9Vh5VldqZzdjempXPQ\"\n      />\n\n      {\n        preciseMarkerPos.lat !== markerPos.lat && preciseMarkerPos.lng !== markerPos.lng\n        ? <Circle center={preciseMarkerPos} radius={5} pathOptions={{ fillOpacity: 1, color: 'var(--primary-dark, black)' }} />\n        : null\n      }\n      {\n        markerPos.lat !== 0 && markerPos.lng !== 0\n        ? <Rectangle bounds={rectangle} pathOptions={{ fillColor: 'var(--primary, black)', color: 'var(--primary-dark, black)', fillOpacity: 0.3, weight: 5, lineCap: 'square', lineJoin: 'square' }} />\n        : null\n      }\n      <MapEventHandler onMap={handleMap} onClick={handleMapClick} />\n      <MapScale />\n    </MapContainer>\n  </div>\n}\n\nexport default GeoInput\n","import { useCallback, useEffect, useState, useRef } from 'react'\nimport useKeyPress from '../hooks/useKeyPress.js'\nimport computeHasValue from '../functions/computeHasValue.js'\n\nimport { IonButton } from '@ionic/react'\n\nimport { withLocalization, Localized } from '../Localized.js'\n\nimport classes from './Question.module.css'\nimport GeoInput from './GeoInput.js'\n\nlet abc = 'abcdefghijklmnopqrstuvwxyz'\nconst ABC = abc.toUpperCase().split('')\nabc = abc.split('')\nconst keys2listen = ['Escape', 'Enter', ...abc, ...ABC]\n\nfunction Question({ fluentByObject, getString, _id, question, description, input, defaultValue: defaultValueObject, onSubmit }) {\n  const inputRef = useRef()\n\n  const defaultValue = !!defaultValueObject ? defaultValueObject.value : new Set()\n  let firstDefaultValue = [...defaultValue]\n  if (firstDefaultValue.length > 0) {\n    firstDefaultValue = firstDefaultValue[0]\n  } else {\n    firstDefaultValue = null\n  }\n  const writeInDefaultValue = !!defaultValueObject ? defaultValueObject.write_in : null\n\n  const [value, setValue] = useState(defaultValue)\n  const [writeInValue, setWriteInValue] = useState(writeInDefaultValue)\n\n  const [, setValueJSON] = useState(JSON.stringify([...value]))\n\n  const setValueBoth = useCallback(newValue => {\n    setValue(newValue)\n    setValueJSON(JSON.stringify([...newValue]))\n  }, [setValue, setValueJSON])\n\n  const [writeInIsActive, setWriteInIsActive] = useState(false)\n\n  let hasValue = computeHasValue(value)\n\n  useKeyPress(keys2listen, event => {\n    if (event.key === 'Escape') {\n      if (!!inputRef && !!inputRef.current) {\n        inputRef.current.blur()\n      }\n    } if (\n      event.key === 'Enter'\n      && (!input.required || (input.required && hasValue))\n    ) {\n      if (input.type === 'choice' && hasValue) {\n        onSubmit({\n          _id,\n          value,\n          ...(computeHasValue(writeInValue) ? { write_in: writeInValue } : {})\n        })\n      } else if (\n        input.type === 'number'\n        || input.type === 'short_text'\n        || (input.type === 'long_text' && !writeInIsActive)\n      ) {\n        onSubmit({ _id, value })\n      }\n    } else if (input.type === 'choice' && !writeInIsActive) {\n      let index = abc.indexOf(event.key)\n      if (index <= -1) {\n        index = ABC.indexOf(event.key)\n      }\n      if (index >= 0 && input.options[index]) {\n        const option = input.options[index]._id\n\n        if (input.multiple === true) {\n          const newValue = value\n          if (newValue.has(option)) {\n            newValue.delete(option)\n          } else {\n            newValue.add(option)\n          }\n          setValueBoth(newValue)\n        } else {\n          let oldValue = [...value]\n          if (oldValue.length > 0) {\n            oldValue = oldValue[0]\n          } else {\n            oldValue = null\n          }\n\n          const newValue = new Set()\n          if (option !== oldValue) {\n            newValue.add(option)\n          }\n          setValueBoth(newValue)\n\n          if (!!onSubmit && option !== oldValue) {\n            onSubmit({\n              _id,\n              value: newValue,\n              ...(computeHasValue(writeInValue) ? { write_in: writeInValue } : {})\n            })\n          }\n        }\n      }\n    }\n  })\n\n  const storeValue = useCallback(event => {\n    let newValue = event.target.value\n\n    if (input.type === 'number') {\n      newValue = parseFloat(newValue)\n      if (isNaN(newValue)) {\n        newValue = null\n      }\n    }\n\n    const newValueSet = new Set()\n    newValueSet.add(newValue)\n    setValueBoth(newValueSet)\n  }, [setValueBoth, input.type])\n\n  const storeGeoValue = useCallback(value => {\n    const newValueSet = new Set()\n    if (!!value) {\n      newValueSet.add(value)\n    }\n    setValueBoth(newValueSet)\n  }, [setValueBoth])\n\n  // START write in\n  const storeWriteInValue = useCallback(event => {\n    let option = event.target.value\n\n    if (input.type === 'number' && option !== '') {\n      option = parseFloat(option)\n      if (isNaN(option)) {\n        option = null\n      }\n    }\n\n    if (input.multiple === true) {\n      const newValue = value\n      newValue.delete(writeInValue) // delete old value\n      if (newValue.has(option)) {\n        newValue.delete(option)\n      } else if (option !== '') {\n        newValue.add(option)\n      }\n      setValueBoth(newValue)\n    } else {\n      const newValue = new Set()\n      if (option !== '') {\n        newValue.add(option)\n      }\n      setValueBoth(newValue)\n    }\n\n    setWriteInValue(option)\n  }, [input.type, input.multiple, value, writeInValue, setValueBoth, setWriteInValue])\n\n  const handleWriteInFocus = useCallback(() => {\n    setWriteInIsActive(true)\n  }, [setWriteInIsActive])\n\n  const handleWriteInBlur = useCallback(() => {\n    setWriteInIsActive(false)\n  }, [setWriteInIsActive])\n  // END write in\n\n  const handleChoiceClick = useCallback(option => {\n    if (input.multiple === true) {\n      const newValue = value\n      if (newValue.has(option)) {\n        newValue.delete(option)\n      } else {\n        newValue.add(option)\n      }\n      setValueBoth(newValue)\n    } else {\n      let oldValue = [...value]\n      if (oldValue.length > 0) {\n        oldValue = oldValue[0]\n      } else {\n        oldValue = null\n      }\n\n      const newValue = new Set()\n      if (option !== oldValue) {\n        newValue.add(option)\n      }\n      setValueBoth(newValue)\n\n      if (!!onSubmit && option !== oldValue) {\n        onSubmit({\n          _id,\n          value: newValue,\n          ...(computeHasValue(writeInValue) ? { write_in: writeInValue } : {})\n        })\n      }\n    }\n  }, [value, setValueBoth, onSubmit, input.multiple, _id, writeInValue])\n\n  const handleSubmit = useCallback(() => {\n    if (!!onSubmit && (!input.required || (input.required && hasValue))) {\n      onSubmit({\n        _id,\n        value,\n        ...(computeHasValue(writeInValue) ? { write_in: writeInValue } : {})\n      })\n    }\n  }, [input, hasValue, onSubmit, _id, value, writeInValue])\n\n  // auto focus input field\n  useEffect(() => {\n    if (input.type !== 'choice' && !!inputRef && !!inputRef.current && !hasValue) {\n      inputRef.current.focus()\n    }\n  }, [input.type, inputRef, hasValue])\n\n  // do nothing if no question supplied\n  if (!(!!_id)) {\n    return null\n  }\n\n  let input_component = null\n  if (input.type === 'number') {\n    input_component = <input ref={inputRef} type=\"number\" placeholder={getString('placeholder_number')} min={0} onChange={storeValue} defaultValue={firstDefaultValue} />\n  } else if (input.type === 'short_text' || input.type === 'date') { // TODO: date sollte ein eigenes echtes input sein, das direkt überprüft, ob es ein echtes Datum ist.\n    input_component = <input ref={inputRef} type=\"text\" placeholder={getString('placeholder_short_text')} onChange={storeValue} defaultValue={firstDefaultValue} />\n  } else if (input.type === 'long_text') {\n    input_component = <textarea\n      ref={inputRef}\n      onChange={storeValue}\n      onFocus={handleWriteInFocus}\n      onBlur={handleWriteInBlur}\n      defaultValue={firstDefaultValue}\n      placeholder={getString('placeholder_long_text')}\n    />\n  } else if (input.type === 'choice') {\n    input_component = <>\n      {\n        !!input.options\n          ? input.options.map((option, index) => {\n            const thisOption = fluentByObject(option)\n\n            let title = null\n            let description = null\n\n            if (typeof thisOption === 'string' || thisOption instanceof String) {\n              title = thisOption\n            } else {\n              if (!!thisOption.title) {\n                title = thisOption.title\n              }\n              if (!!thisOption.description) {\n                description = thisOption.description\n              }\n            }\n\n            if (title === null) {\n              return null\n            }\n\n            return <div\n                key={option._id}\n                className=\"body2\"\n                style={{ whiteSpace: 'nowrap', display: 'flex', marginBottom: '8px' }}\n              >\n              <span className={classes.button_key}>\n                {ABC[index]}\n              </span>\n              <p className=\"body2\" style={{ whiteSpace: 'normal', margin: '0' }}>\n                <IonButton\n                  style={{ verticalAlign: 'middle', margin: '0 0 2px 0', fontWeight: 'bold' }}\n                  fill={value.has(option._id) ? 'solid' : 'outline'}\n                  size=\"small\"\n                  onClick={() => handleChoiceClick(option._id)}\n                >\n                  {title}\n                </IonButton>\n                {\n                  description !== null\n                  ? <span style={{ margin: '0 0 0 8px' }}>{description}</span>\n                  : null\n                }\n              </p>\n            </div>\n          })\n        : null\n      }\n      {\n        !!input.write_in\n          ? <div>\n            <input\n              ref={inputRef}\n              type=\"text\"\n              placeholder={getString('placeholder_write_in_short_text')}\n              onChange={storeWriteInValue}\n              onFocus={handleWriteInFocus}\n              onBlur={handleWriteInBlur}\n              defaultValue={writeInDefaultValue}\n            />\n          </div>\n        : null\n      }\n    </>\n  } else if (input.type === 'geo') {\n    input_component = <>\n      <GeoInput onChange={storeGeoValue} defaultValue={firstDefaultValue} />\n      <p>{value}</p>\n    </>\n  }\n\n  return (\n    <div className={classes.question}>\n      <h3 className=\"subtitle1\">{fluentByObject(question)}</h3>\n      {!!description ? fluentByObject(description, '').split('\\n').filter(Boolean).map(line => <p>{line}</p>) : null}\n      {input.required ? <p style={{ color: 'darkred', fontWeight: 'bold' }}><Localized id=\"required_question\" /></p> : null}\n      {input_component}\n      {\n        (hasValue || !input.required)\n        && (input.type !== 'choice' || input.write_in === true)\n          ? <p>\n            <IonButton style={{ verticalAlign: 'middle', margin: '0 16px 0 0' }} size=\"default\" onClick={handleSubmit}><Localized id=\"submit_question\" /></IonButton>\n            {\n              (\n                input.type === 'number'\n                || input.type === 'short_text'\n                || (input.type === 'long_text' && !writeInIsActive)\n                || (input.type === 'choice' && input.write_in === true && hasValue)\n              )\n              && (!input.required || (input.required && hasValue))\n              ? <span style={{ verticalAlign: 'middle' }}>\n                <Localized id=\"press_enter_info\" elems={{strong: <strong/>}} />\n              </span>\n              : null\n            }\n          </p>\n          : null\n      }\n    </div>\n  )\n}\n\nexport default withLocalization(Question)\n","export default __webpack_public_path__ + \"static/media/questions.b2c86f2e.yaml\";","import { useEffect, useState, useCallback } from 'react'\nimport yaml from 'js-yaml'\n\nimport { IonButton } from '@ionic/react'\n\nimport { Localized } from '../Localized.js'\n\nimport classes from './Survey.module.css'\nimport Question from './Question.js'\nimport useKeyPress from '../hooks/useKeyPress.js'\nimport computeHasValue from '../functions/computeHasValue.js'\n\nimport questions_path from '../questions.yaml'\n\nimport { gql, useMutation } from '@apollo/client'\n\nconst submit_incident = gql`\n  mutation ($text: String, $properties: JSONObject) {\n    incident(text: $text, properties: $properties)\n  }\n`\n\nfunction saveTextAsFile(textToWrite, fileNameToSaveAs) {\n  // source: https://stackoverflow.com/questions/609530/download-textarea-contents-as-a-file-using-only-javascript-no-server-side\n  var textFileAsBlob = new Blob([textToWrite], { type: 'text/plain' })\n  var downloadLink = document.createElement('a')\n  downloadLink.download = fileNameToSaveAs\n  downloadLink.innerHTML = 'Download File'\n  if (window.webkitURL != null) {\n    // Chrome allows the link to be clicked\n    // without actually adding it to the DOM.\n    downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob)\n  }\n  else {\n    // Firefox requires the link to be added to the DOM\n    // before it can be clicked.\n    downloadLink.href = window.URL.createObjectURL(textFileAsBlob)\n    downloadLink.onclick = function () {\n      downloadLink.parentNode.removeChild(downloadLink)\n    }\n    downloadLink.style.display = 'none'\n    document.body.appendChild(downloadLink)\n  }\n\n  downloadLink.click()\n}\n\nconst mainTextQuestion = 'what_happened'\n\nfunction getValueTitle(value, options) {\n  const thisOption = !!options && !!options[value] ? options[value].de : value\n\n  let title = null\n\n  if (typeof thisOption === 'string' || thisOption instanceof String) {\n    title = thisOption\n  } else {\n    if (!!thisOption.title) {\n      title = thisOption.title\n    }\n  }\n\n  return title\n}\n\nfunction Survey() {\n  const [uploaded, setUploaded] = useState(false)\n  const [questions, setQuestions] = useState([])\n  const [questionsById, setQuestionsById] = useState({})\n  const [answers, setAnswers] = useState({})\n  const [currentQuestionsIndex, setCurrentQuestionsIndex] = useState(-1)\n\n  const [submitIncident, { loading: mutationLoading, error: mutationError }] = useMutation(submit_incident, {\n    onCompleted() {\n      setUploaded(true)\n    },\n    onError(error) {\n      console.error(error)\n    }\n  })\n\n  useEffect(() => {\n    async function load_data() {\n      let response = await fetch(questions_path)\n      let text = await response.text() // read response body as text\n\n      const data = yaml.load(text)\n\n      if (!!data && !!data.questions) {\n        const dataForArray = JSON.parse(JSON.stringify(data)) // TODO: Please check, why data needs to be cloned!\n        const dataForObject = JSON.parse(JSON.stringify(data)) // TODO: Please check, why data needs to be cloned!\n\n        setQuestions( // TODO: Somewhere in the following lines, data is would get overwritten if not cloned.\n          Object.entries(dataForArray.questions)\n          .map(questionEntry => {\n            let thisQuestionData = questionEntry[1]\n\n            if (\n              !!thisQuestionData.input\n              && !!thisQuestionData.input.options\n            ) {\n              thisQuestionData.input.options = Object.entries(thisQuestionData.input.options)\n                .map(optionsEntry => ({\n                  _id: optionsEntry[0],\n                  ...optionsEntry[1]\n                }))\n            }\n\n            return {\n              _id: questionEntry[0],\n              ...thisQuestionData\n            }\n          })\n        )\n\n        setQuestionsById(\n          Object.entries(dataForObject.questions)\n          .reduce((obj, questionEntry) => {\n            const _id = questionEntry[0]\n            let thisQuestionData = questionEntry[1]\n\n            if (!thisQuestionData.input) {\n              thisQuestionData.input = {}\n            }\n            if (!thisQuestionData.input.options) {\n              thisQuestionData.input.options = {}\n            }\n\n            obj[_id] = {\n              _id,\n              ...thisQuestionData\n            }\n\n            return obj\n          }, {})\n        )\n      } else {\n        setQuestionsById({})\n        setQuestions([])\n      }\n    }\n    load_data()\n  }, [setQuestions, setQuestionsById])\n\n  const handleChange = useCallback(data => {\n    if (!!data && !!data._id) {\n      if (computeHasValue(data.value)) {\n        answers[data._id] = data\n      } else if (!!answers[data._id]){\n        delete answers[data._id]\n      }\n      setAnswers(answers)\n    }\n    if (currentQuestionsIndex <= questions.length) {\n      setCurrentQuestionsIndex(currentQuestionsIndex + 1)\n    }\n  }, [setAnswers, answers, setCurrentQuestionsIndex, currentQuestionsIndex, questions.length])\n\n  const prevQuestion = useCallback(() => {\n    if (currentQuestionsIndex > -1) {\n      setCurrentQuestionsIndex(currentQuestionsIndex - 1)\n    }\n  }, [setCurrentQuestionsIndex, currentQuestionsIndex])\n\n  const nextQuestion = useCallback(() => {\n    if (currentQuestionsIndex <= questions.length) {\n      if (currentQuestionsIndex <= 0) { // if -1 (intro)\n        setCurrentQuestionsIndex(currentQuestionsIndex + 1)\n      } else { // if between 0 and questions.length\n        const currentQuestion = questions[currentQuestionsIndex]\n        if (!currentQuestion.input.required) {\n          setCurrentQuestionsIndex(currentQuestionsIndex + 1)\n        }\n      }\n    }\n  }, [setCurrentQuestionsIndex, currentQuestionsIndex, questions])\n\n  const toTheBeginning = useCallback(() => {\n    setCurrentQuestionsIndex(-1)\n  }, [setCurrentQuestionsIndex])\n\n  const gotoFirstQuestion = useCallback(() => {\n    setCurrentQuestionsIndex(0)\n  }, [setCurrentQuestionsIndex])\n\n  useKeyPress(['ArrowRight', 'ArrowLeft'], event => {\n    if (event.target.nodeName === 'BODY') {\n      if (event.key === 'ArrowUp' || event.key === 'ArrowLeft') {\n        prevQuestion()\n      } else {\n        nextQuestion()\n      }\n    }\n  })\n\n  const handleSendData = useCallback(() => {\n    let answersForSending = Object.values(answers)\n      .filter(answer => answer._id !== null && answer.value !== null)\n\n    if (answersForSending.length === 0) {\n      console.warn('⚠️ Keine Angaben. Unnötig abzusenden. But this if shoul\\'nt get called anyway.')\n    } else {\n      answersForSending = answersForSending\n        .reduce((obj, answer) => {\n          const thisQuestion = questionsById[answer._id]\n\n          const value = [...answer.value]\n          if (thisQuestion.input.multiple === true) {\n            obj[answer._id] = value\n          } else {\n            obj[answer._id] = value[0]\n          }\n          return obj\n        }, {})\n\n      const text = answersForSending[mainTextQuestion] || ''\n      delete answersForSending[mainTextQuestion]\n\n      submitIncident({\n        variables: {\n          text,\n          properties: answersForSending\n        },\n        ignoreResults: false\n      })\n    }\n  }, [answers, questionsById, submitIncident])\n\n  const handleDownloadData = useCallback(() => {\n    let answersForDownload = Object.values(answers)\n      .filter(answer => answer._id !== null && answer.value !== null)\n\n    if (answersForDownload.length === 0) {\n      console.warn('⚠️ Keine Angaben. Unnötig runterzuladen. But this if shoul\\'nt get called anyway.')\n    } else {\n      let now = new Date().toISOString()\n      now = now.replace(/T/g, ' ')\n      const nowForFilename = now.replace(/(:|\\.)/g, '-')\n\n      answersForDownload = `# Dein Vorfall (${now})\\n\\n${\n        answersForDownload.map(answer => {\n          const thisQuestion = questionsById[answer._id]\n          return `## ${\n            thisQuestion.question.de\n          }\\n\\n${\n            thisQuestion.input.multiple === true\n            ? [...answer.value].map(thisValue => `- ${getValueTitle(thisValue, thisQuestion.input.options)}`).join('\\n')\n            : getValueTitle([...answer.value][0], thisQuestion.input.options)\n          }`\n        }).join('\\n\\n')\n      }`\n\n      saveTextAsFile(answersForDownload, `Dein Vorfall ${nowForFilename}.md.txt`)\n    }\n  }, [answers, questionsById])\n\n  if (!(!!questions)) {\n    return null\n  }\n\n  const currentQuestion = questions[currentQuestionsIndex]\n\n  const answersArray = Object.values(answers)\n    .filter(answer => answer.value !== null)\n\n  return (\n    <div className={classes.survey}>\n      <div className={classes.progress} style={{\n        '--width': `${((currentQuestionsIndex) / questions.length) * 100}%`,\n        opacity: (currentQuestionsIndex <= 0 ? 0 : 1)\n      }} />\n      <div className={classes.content}>\n        <div className={classes.contentWrapper}>\n          {\n            currentQuestionsIndex === -1\n            ? <>\n                <h3>Vorfall melden</h3>\n                <p>Hier kannst du einen queerfeindlichen Übergriff melden.</p>\n                <p>Bei Fragen kannst du dich an <a href=\"mailto:info@queerfeindlichkeit.de\" target=\"_blank\" rel=\"noreferrer\">info@queerfeindlichkeit.de</a> wenden.</p>\n                <IonButton size=\"default\" onClick={gotoFirstQuestion}><Localized id=\"start_survey\" /></IonButton>\n            </>\n            : (\n              !!currentQuestion\n              ? <>\n                <Question\n                  key={currentQuestion._id}\n                  onSubmit={handleChange}\n                  defaultValue={answers[currentQuestion._id] || null}\n                  {...currentQuestion}\n                />\n              </>\n              : (\n                answersArray.length === 0\n                ? <>\n                  <h3>Hmmm…</h3>\n                  <p>Du hast keine Angaben gemacht. Beschreib deinen Vorfall bitte etwas detailierter.</p>\n                  <IonButton size=\"default\" onClick={toTheBeginning}><Localized id=\"back_to_beginning\" /></IonButton>\n                </>\n                : (\n                  uploaded\n                  ? <>\n                    <h3>Vielen Dank!</h3>\n                    <p>Dein Vorfall wurde hochgeladen.</p>\n                    <p><strong>Vielen Dank, dass Du hilfst Queerfeindlichkeit sichtbar zu machen!</strong></p>\n                            <p>Du möchtest wissen, wie es weitergeht? Auf <a href=\"https://www.instagram.com/queerfeindlichkeit/\" target=\"_blank\" rel=\"noreferrer\">Instagram</a> und  <a href=\"https://twitter.com/anyway_koeln\" target=\"_blank\" rel=\"noreferrer\">Twitter</a> veröffentlichen wir Daten und helfen dir gegen Queerfeindlichkeit anzukommen.</p>\n                    <hr />\n                    <p>Hier kannst du dir noch Deine Daten abspeichern:</p>\n                    <IonButton size=\"default\" onClick={handleDownloadData}><Localized id=\"download_your_incident_data\" /></IonButton>\n                  </>\n                  : <>\n                    <h3>Deine Angaben</h3>\n                    <p>Hier kannst du nochmal über deine Angaben drüber schauen.<br />Geh gerne zurück um etwas zu koorigieren.</p>\n                    <p>Wenn du zufrieden bist, klick unten auf <strong>„Vorfall eintragen”</strong>.</p>\n                    <p>Deine Daten kannst du dir unter <strong>„Daten runterladen”</strong>abspeichern.</p>\n                    <hr />\n                    {\n                      answersArray.map(answer => {\n                        const thisQuestion = questionsById[answer._id]\n\n                        return <div key={answer._id}>\n                          <div className=\"subtitle1\">{thisQuestion.question.de}</div>\n                          {\n                            thisQuestion.input.multiple === true\n                              ? <p><ul>\n                                {[...answer.value].map(thisValue => <li>{getValueTitle(thisValue, thisQuestion.input.options)}</li>)}\n                              </ul></p>\n                              : getValueTitle([...answer.value][0], thisQuestion.input.options)\n                                .split('\\n')\n                                .map(line => <p>{line}</p>)\n                          }\n                        </div>\n                      })\n                    }\n                    <hr />\n                    <IonButton fill=\"outline\" size=\"default\" onClick={handleDownloadData}><Localized id=\"download_your_incident_data\" /></IonButton>\n                    <IonButton size=\"default\" onClick={handleSendData}><Localized id=\"submit_incident\" /></IonButton>\n                    {mutationLoading && <p><Localized id=\"uploading\" /></p>}\n                    {mutationError && <p><Localized id=\"error_while_uploading\" /></p>}\n                  </>\n                )\n              )\n            )\n          }\n        </div>\n      </div>\n      <div className={classes.actions}>\n        <IonButton disabled={currentQuestionsIndex <= -1} fill=\"outline\" size=\"default\" onClick={prevQuestion}>\n          <Localized id=\"prev\" />\n        </IonButton>\n        <IonButton disabled={currentQuestionsIndex >= questions.length || (!!currentQuestion && !!currentQuestion.input && currentQuestion.input.required)} fill=\"outline\" size=\"default\" onClick={nextQuestion}>\n          <Localized id=\"next\" />\n        </IonButton>\n      </div>\n    </div>\n  )\n}\n\nexport default Survey\n"],"sourceRoot":""}