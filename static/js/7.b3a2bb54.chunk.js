(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[7],{225:function(e,t,n){e.exports={survey:"Survey_survey__3pPR3",progress:"Survey_progress__1lvcc",content:"Survey_content__2w_sB",contentWrapper:"Survey_contentWrapper__380v2",actions:"Survey_actions__Qs2yy"}},226:function(e,t,n){e.exports={question:"Question_question__1iSNS",button_key:"Question_button_key__1i8i4",option:"Question_option__3f0DC"}},229:function(e,t,n){e.exports={mapWrapper:"GeoInput_mapWrapper__3HwMS",map:"GeoInput_map__3L-Nl",searchInput:"GeoInput_searchInput__1aYZ2",zoomButtonsWrapper:"GeoInput_zoomButtonsWrapper__Nxaw_",zoomButton:"GeoInput_zoomButton__n1Agi"}},230:function(e,t,n){},259:function(e,t,n){"use strict";n.r(t);var a=n(47),i=n(10),c=n.n(i),r=n(20),l=n(21),s=n(11),u=n(223),o=n(0),d=n(224),j=n(49),b=n(92),p=n(225),O=n.n(p);function f(e,t){Object(o.useEffect)((function(){function n(n){e.includes(n.key)&&t(n)}return window.addEventListener("keyup",n),function(){return window.removeEventListener("keyup",n)}}),[e,t])}function h(e){var t=!1;return"object"===typeof e&&e instanceof Set&&e.size>0||Array.isArray(e)&&e.length>0||("string"===typeof e||e instanceof String)&&e.length>0?t=!0:"number"!==typeof e||isNaN(e)?"object"===typeof e&&null!==e&&Object.keys(e).length>0&&(t=!0):t=!0,t}var x=n(226),m=n.n(x),g=n(251),_=n(252),v=n(264),y=n(265),k=n(253),w=(n(227),n(228)),S=n(229),C=n.n(S),N=(n(230),n(231)),q=n(232),z=n(233),D=n(3);function B(){var e=Object(g.a)();return Object(o.useEffect)((function(){window.L.control.scale().addTo(e)}),[e]),null}var V=Object(b.b)((function(e){var t=e.getString,n=e.map,a=Object(o.useState)(),i=Object(s.a)(a,2),c=i[0],r=i[1],l=Object(o.useState)(),u=Object(s.a)(l,2),d=u[0],j=u[1];Object(o.useEffect)((function(){j(new w.a({params:{email:"tech@queerfeindlichkeit.de"}}))}),[j]);var b=Object(o.useCallback)((function(e){clearTimeout(c),r(setTimeout((function(){d&&n&&d.search({query:e.target.value}).then((function(e){e.length>0&&n.fitBounds(e[0].bounds)}))}),500))}),[c,r,d,n]);return Object(D.jsx)("input",{className:C.a.searchInput,type:"text",onChange:b,placeholder:t("placeholder_search")})}));function I(e){var t=e.map,n=Object(o.useCallback)((function(e){t&&t.zoomIn(1)}),[t]),a=Object(o.useCallback)((function(e){t&&t.zoomOut(1)}),[t]);return Object(D.jsxs)("div",{className:C.a.zoomButtonsWrapper,children:[Object(D.jsx)(j.a,{className:C.a.zoomButton,onClick:n,children:"+"}),Object(D.jsx)(j.a,{className:C.a.zoomButton,onClick:a,children:"-"})]})}function A(e){var t=e.onMap,n=e.onClick,a=Object(g.a)();return Object(o.useEffect)((function(){t(a)}),[t,a]),Object(g.b)("click",n),null}var F=100,E=.005;var U=function(e){var t=e.onChange,n=e.defaultValue,a=Object(o.useState)(),i=Object(s.a)(a,2),c=i[0],r=i[1],l=(n||"").split(",").map((function(e){return parseFloat(e)})),u=Object(o.useState)({lat:l[0]||0,lng:l[1]||0}),d=Object(s.a)(u,2),j=d[0],b=d[1],p=Object(o.useState)(j),O=Object(s.a)(p,2),f=O[0],h=O[1],x=function(e){var t=e.lat,n=e.lng;return[[t-E,n-E],[t+E,n+E]]}(j);Object(o.useEffect)((function(){var e=window.L;delete e.Icon.Default.prototype._getIconUrl,e.Icon.Default.mergeOptions({iconRetinaUrl:N.a,iconUrl:q.a,shadowUrl:z.a})}),[]);var m=Object(o.useCallback)((function(e){var n=e.latlng,a=n.lat,i=n.lng,c=Math.round(a*F)/F,r=Math.round(i*F)/F;c===j.lat&&r===j.lng&&(c=0,r=0,a=0,i=0),h({lat:a,lng:i}),b({lat:c,lng:r}),t(0===c&&0===r?null:"".concat(c,", ").concat(r))}),[j,h,b,t]),g=Object(o.useCallback)((function(e){r(e)}),[r]);return Object(D.jsxs)("div",{className:C.a.mapWrapper,children:[Object(D.jsx)(V,{map:c}),Object(D.jsx)(I,{map:c}),Object(D.jsxs)(_.a,{className:C.a.map,center:[51.2964955,9.9019876],zoom:5.5,scrollWheelZoom:!1,zoomControl:!1,children:[Object(D.jsx)(v.a,{attribution:'<a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noreferrer">\xa9 OpenStreetMap</a> <a href="https://www.mapbox.com/about/maps/" target="_blank" rel="noreferrer">\xa9 Mapbox</a>',url:"https://api.mapbox.com/styles/v1/qiekub/cko1ikam20wgq18p9wd200uy0/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoicWlla3ViIiwiYSI6ImNrbzFpY3NtZjA4dXQyb3M1OGU5czNqZzYifQ.UFFb9Vh5VldqZzdjempXPQ"}),f.lat!==j.lat&&f.lng!==j.lng?Object(D.jsx)(y.a,{center:f,radius:5,pathOptions:{fillOpacity:1,color:"var(--primary-dark, black)"}}):null,0!==j.lat&&0!==j.lng?Object(D.jsx)(k.a,{bounds:x,pathOptions:{fillColor:"var(--primary, black)",color:"var(--primary-dark, black)",fillOpacity:.3,weight:5,lineCap:"square",lineJoin:"square"}}):null,Object(D.jsx)(A,{onMap:g,onClick:m}),Object(D.jsx)(B,{})]})]})},W="abcdefghijklmnopqrstuvwxyz",L=W.toUpperCase().split("");W=W.split("");var J=["Escape","Enter"].concat(Object(a.a)(W),Object(a.a)(L));var M,R=Object(b.b)((function(e){var t=e.getString,n=e._id,i=e.question,c=e.description,l=e.input,u=e.defaultValue,d=e.onSubmit,p=Object(o.useRef)(),O=u?u.value:new Set,x=Object(a.a)(O);x=x.length>0?x[0]:null;var g=u?u.write_in:null,_=Object(o.useState)(O),v=Object(s.a)(_,2),y=v[0],k=v[1],w=Object(o.useState)(g),S=Object(s.a)(w,2),C=S[0],N=S[1],q=Object(o.useState)(JSON.stringify(Object(a.a)(y))),z=Object(s.a)(q,2)[1],B=Object(o.useCallback)((function(e){k(e),z(JSON.stringify(Object(a.a)(e)))}),[k,z]),V=Object(o.useState)(!1),I=Object(s.a)(V,2),A=I[0],F=I[1],E=h(y);f(J,(function(e){if("Escape"===e.key&&p&&p.current&&p.current.blur(),"Enter"===e.key&&(!l.required||l.required&&E))"choice"===l.type&&E?d(Object(r.a)({_id:n,value:y},h(C)?{write_in:C}:{})):("number"===l.type||"short_text"===l.type||"long_text"===l.type&&!A)&&d({_id:n,value:y});else if("choice"===l.type&&!A){var t=W.indexOf(e.key);if(t<=-1&&(t=L.indexOf(e.key)),t>=0&&l.options[t]){var i=l.options[t]._id;if(!0===l.multiple){var c=y;c.has(i)?c.delete(i):c.add(i),B(c)}else{var s=Object(a.a)(y);s=s.length>0?s[0]:null;var u=new Set;i!==s&&u.add(i),B(u),d&&i!==s&&d(Object(r.a)({_id:n,value:u},h(C)?{write_in:C}:{}))}}}}));var M=Object(o.useCallback)((function(e){var t=e.target.value;"number"===l.type&&(t=parseFloat(t),isNaN(t)&&(t=null));var n=new Set;n.add(t),B(n)}),[B,l.type]),R=Object(o.useCallback)((function(e){var t=new Set;e&&t.add(e),B(t)}),[B]),Q=Object(o.useCallback)((function(e){var t=e.target.value;if("number"===l.type&&""!==t&&(t=parseFloat(t),isNaN(t)&&(t=null)),!0===l.multiple){var n=y;n.delete(C),n.has(t)?n.delete(t):""!==t&&n.add(t),B(n)}else{var a=new Set;""!==t&&a.add(t),B(a)}N(t)}),[l.type,l.multiple,y,C,B,N]),G=Object(o.useCallback)((function(){F(!0)}),[F]),H=Object(o.useCallback)((function(){F(!1)}),[F]),T=Object(o.useCallback)((function(e){if(!0===l.multiple){var t=y;t.has(e)?t.delete(e):t.add(e),B(t)}else{var i=Object(a.a)(y);i=i.length>0?i[0]:null;var c=new Set;e!==i&&c.add(e),B(c),d&&e!==i&&d(Object(r.a)({_id:n,value:c},h(C)?{write_in:C}:{}))}}),[y,B,d,l.multiple,n,C]),Y=Object(o.useCallback)((function(){d&&(!l.required||l.required&&E)&&d(Object(r.a)({_id:n,value:y},h(C)?{write_in:C}:{}))}),[l,E,d,n,y,C]);if(Object(o.useEffect)((function(){"choice"!==l.type&&p&&p.current&&!E&&p.current.focus()}),[l.type,p,E]),!n)return null;var Z=null;return"number"===l.type?Z=Object(D.jsx)("input",{ref:p,type:"number",placeholder:t("placeholder_number"),min:0,onChange:M,defaultValue:x}):"short_text"===l.type||"date"===l.type?Z=Object(D.jsx)("input",{ref:p,type:"text",placeholder:t("placeholder_short_text"),onChange:M,defaultValue:x}):"long_text"===l.type?Z=Object(D.jsx)("textarea",{ref:p,onChange:M,onFocus:G,onBlur:H,defaultValue:x,placeholder:t("placeholder_long_text")}):"choice"===l.type?Z=Object(D.jsxs)(D.Fragment,{children:[l.options?l.options.map((function(e,t){var n=e.de,a=null,i=null;return"string"===typeof n||n instanceof String?a=n:(n.title&&(a=n.title),n.description&&(i=n.description)),null===a?null:Object(D.jsxs)("div",{className:"body2",style:{whiteSpace:"nowrap",display:"flex",marginBottom:"8px"},children:[Object(D.jsx)("span",{className:m.a.button_key,children:L[t]}),Object(D.jsxs)("p",{className:"body2",style:{whiteSpace:"normal",margin:"0"},children:[Object(D.jsx)(j.a,{style:{verticalAlign:"middle",margin:"0 0 2px 0",fontWeight:"bold"},fill:y.has(e._id)?"solid":"outline",size:"small",onClick:function(){return T(e._id)},children:a}),null!==i?Object(D.jsx)("span",{style:{margin:"0 0 0 8px"},children:i}):null]})]},e._id)})):null,l.write_in?Object(D.jsx)("div",{children:Object(D.jsx)("input",{ref:p,type:"text",placeholder:t("placeholder_write_in_short_text"),onChange:Q,onFocus:G,onBlur:H,defaultValue:g})}):null]}):"geo"===l.type&&(Z=Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(U,{onChange:R,defaultValue:x}),Object(D.jsx)("p",{children:y})]})),Object(D.jsxs)("div",{className:m.a.question,children:[Object(D.jsx)("h3",{className:"subtitle1",children:i.de}),c?c.de.split("\n").filter(Boolean).map((function(e){return Object(D.jsx)("p",{children:e})})):null,l.required?Object(D.jsx)("p",{style:{color:"darkred",fontWeight:"bold"},children:Object(D.jsx)(b.a,{id:"required_question"})}):null,Z,!E&&l.required||"choice"===l.type&&!0!==l.write_in?null:Object(D.jsxs)("p",{children:[Object(D.jsx)(j.a,{style:{verticalAlign:"middle",margin:"0 16px 0 0"},size:"default",onClick:Y,children:Object(D.jsx)(b.a,{id:"submit_question"})}),("number"===l.type||"short_text"===l.type||"long_text"===l.type&&!A||"choice"===l.type&&!0===l.write_in&&E)&&(!l.required||l.required&&E)?Object(D.jsx)("span",{style:{verticalAlign:"middle"},children:Object(D.jsx)(b.a,{id:"press_enter_info",elems:{strong:Object(D.jsx)("strong",{})}})}):null]})]})})),Q=n.p+"static/media/questions.b2c86f2e.yaml",G=n(83),H=Object(G.gql)(M||(M=Object(u.a)(["\n  mutation ($text: String, $properties: JSONObject) {\n    incident(text: $text, properties: $properties)\n  }\n"])));function T(e,t){var n=t&&t[e]?t[e].de:e,a=null;return"string"===typeof n||n instanceof String?a=n:n.title&&(a=n.title),a}t.default=function(){var e=Object(o.useState)(!1),t=Object(s.a)(e,2),n=t[0],i=t[1],u=Object(o.useState)([]),p=Object(s.a)(u,2),x=p[0],m=p[1],g=Object(o.useState)({}),_=Object(s.a)(g,2),v=_[0],y=_[1],k=Object(o.useState)({}),w=Object(s.a)(k,2),S=w[0],C=w[1],N=Object(o.useState)(-1),q=Object(s.a)(N,2),z=q[0],B=q[1],V=Object(G.useMutation)(H,{onCompleted:function(){i(!0)},onError:function(e){console.error(e)}}),I=Object(s.a)(V,2),A=I[0],F=I[1],E=F.loading,U=F.error;Object(o.useEffect)((function(){function e(){return(e=Object(l.a)(c.a.mark((function e(){var t,n,a,i,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(Q);case 2:return t=e.sent,e.next=5,t.text();case 5:n=e.sent,(a=d.a.load(n))&&a.questions?(i=JSON.parse(JSON.stringify(a)),l=JSON.parse(JSON.stringify(a)),m(Object.entries(i.questions).map((function(e){var t=e[1];return t.input&&t.input.options&&(t.input.options=Object.entries(t.input.options).map((function(e){return Object(r.a)({_id:e[0]},e[1])}))),Object(r.a)({_id:e[0]},t)}))),y(Object.entries(l.questions).reduce((function(e,t){var n=t[0],a=t[1];return a.input||(a.input={}),a.input.options||(a.input.options={}),e[n]=Object(r.a)({_id:n},a),e}),{}))):(y({}),m([]));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[m,y]);var W=Object(o.useCallback)((function(e){e&&e._id&&(h(e.value)?S[e._id]=e:S[e._id]&&delete S[e._id],C(S)),z<=x.length&&B(z+1)}),[C,S,B,z,x.length]),L=Object(o.useCallback)((function(){z>-1&&B(z-1)}),[B,z]),J=Object(o.useCallback)((function(){z<=x.length&&(z<=0?B(z+1):x[z].input.required||B(z+1))}),[B,z,x]),M=Object(o.useCallback)((function(){B(-1)}),[B]),Y=Object(o.useCallback)((function(){B(0)}),[B]);f(["ArrowRight","ArrowLeft"],(function(e){"BODY"===e.target.nodeName&&("ArrowUp"===e.key||"ArrowLeft"===e.key?L():J())}));var Z=Object(o.useCallback)((function(){var e=Object.values(S).filter((function(e){return null!==e._id&&null!==e.value}));if(0===e.length)console.warn("\u26a0\ufe0f Keine Angaben. Unn\xf6tig abzusenden. But this if shoul'nt get called anyway.");else{var t=(e=e.reduce((function(e,t){var n=v[t._id],i=Object(a.a)(t.value);return!0===n.input.multiple?e[t._id]=i:e[t._id]=i[0],e}),{})).what_happened||"";delete e.what_happened,A({variables:{text:t,properties:e},ignoreResults:!1})}}),[S,v,A]),$=Object(o.useCallback)((function(){var e=Object.values(S).filter((function(e){return null!==e._id&&null!==e.value}));if(0===e.length)console.warn("\u26a0\ufe0f Keine Angaben. Unn\xf6tig runterzuladen. But this if shoul'nt get called anyway.");else{var t=(new Date).toISOString(),n=(t=t.replace(/T/g," ")).replace(/(:|\.)/g,"-");(function(e,t){var n=new Blob([e],{type:"text/plain"}),a=document.createElement("a");a.download=t,a.innerHTML="Download File",null!=window.webkitURL?a.href=window.webkitURL.createObjectURL(n):(a.href=window.URL.createObjectURL(n),a.onclick=function(){a.parentNode.removeChild(a)},a.style.display="none",document.body.appendChild(a)),a.click()})(e="# Dein Vorfall (".concat(t,")\n\n").concat(e.map((function(e){var t=v[e._id];return"## ".concat(t.question.de,"\n\n").concat(!0===t.input.multiple?Object(a.a)(e.value).map((function(e){return"- ".concat(T(e,t.input.options))})).join("\n"):T(Object(a.a)(e.value)[0],t.input.options))})).join("\n\n")),"Dein Vorfall ".concat(n,".md.txt"))}}),[S,v]);if(!x)return null;var K=x[z],P=Object.values(S).filter((function(e){return null!==e.value}));return Object(D.jsxs)("div",{className:O.a.survey,children:[Object(D.jsx)("div",{className:O.a.progress,style:{"--width":"".concat(z/x.length*100,"%"),opacity:z<=0?0:1}}),Object(D.jsx)("div",{className:O.a.content,children:Object(D.jsx)("div",{className:O.a.contentWrapper,children:-1===z?Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)("h3",{children:"Vorfall melden"}),Object(D.jsx)("p",{children:"Hier kannst du einen queerfeindlichen \xdcbergriff melden."}),Object(D.jsxs)("p",{children:["Bei Fragen kannst du dich an ",Object(D.jsx)("a",{href:"mailto:info@queerfeindlichkeit.de",target:"_blank",rel:"noreferrer",children:"info@queerfeindlichkeit.de"})," wenden."]}),Object(D.jsx)(j.a,{size:"default",onClick:Y,children:Object(D.jsx)(b.a,{id:"start_survey"})})]}):K?Object(D.jsx)(D.Fragment,{children:Object(D.jsx)(R,Object(r.a)({onSubmit:W,defaultValue:S[K._id]||null},K),K._id)}):0===P.length?Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)("h3",{children:"Hmmm\u2026"}),Object(D.jsx)("p",{children:"Du hast keine Angaben gemacht. Beschreib deinen Vorfall bitte etwas detailierter."}),Object(D.jsx)(j.a,{size:"default",onClick:M,children:Object(D.jsx)(b.a,{id:"back_to_beginning"})})]}):n?Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)("h3",{children:"Vielen Dank!"}),Object(D.jsx)("p",{children:"Dein Vorfall wurde hochgeladen."}),Object(D.jsx)("p",{children:Object(D.jsx)("strong",{children:"Vielen Dank, dass Du hilfst Queerfeindlichkeit sichtbar zu machen!"})}),Object(D.jsxs)("p",{children:["Du m\xf6chtest wissen, wie es weitergeht? Auf ",Object(D.jsx)("a",{href:"https://www.instagram.com/queerfeindlichkeit/",target:"_blank",rel:"noreferrer",children:"Instagram"})," und  ",Object(D.jsx)("a",{href:"https://twitter.com/anyway_koeln",target:"_blank",rel:"noreferrer",children:"Twitter"})," ver\xf6ffentlichen wir Daten und helfen dir gegen Queerfeindlichkeit anzukommen."]}),Object(D.jsx)("hr",{}),Object(D.jsx)("p",{children:"Hier kannst du dir noch Deine Daten abspeichern:"}),Object(D.jsx)(j.a,{size:"default",onClick:$,children:Object(D.jsx)(b.a,{id:"download_your_incident_data"})})]}):Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)("h3",{children:"Deine Angaben"}),Object(D.jsxs)("p",{children:["Hier kannst du nochmal \xfcber deine Angaben dr\xfcber schauen.",Object(D.jsx)("br",{}),"Geh gerne zur\xfcck um etwas zu koorigieren."]}),Object(D.jsxs)("p",{children:["Wenn du zufrieden bist, klick unten auf ",Object(D.jsx)("strong",{children:"\u201eVorfall eintragen\u201d"}),"."]}),Object(D.jsxs)("p",{children:["Deine Daten kannst du dir unter ",Object(D.jsx)("strong",{children:"\u201eDaten runterladen\u201d"}),"abspeichern."]}),Object(D.jsx)("hr",{}),P.map((function(e){var t=v[e._id];return Object(D.jsxs)("div",{children:[Object(D.jsx)("div",{className:"subtitle1",children:t.question.de}),!0===t.input.multiple?Object(D.jsx)("p",{children:Object(D.jsx)("ul",{children:Object(a.a)(e.value).map((function(e){return Object(D.jsx)("li",{children:T(e,t.input.options)})}))})}):T(Object(a.a)(e.value)[0],t.input.options).split("\n").map((function(e){return Object(D.jsx)("p",{children:e})}))]},e._id)})),Object(D.jsx)("hr",{}),Object(D.jsx)(j.a,{fill:"outline",size:"default",onClick:$,children:Object(D.jsx)(b.a,{id:"download_your_incident_data"})}),Object(D.jsx)(j.a,{size:"default",onClick:Z,children:Object(D.jsx)(b.a,{id:"submit_incident"})}),E&&Object(D.jsx)("p",{children:Object(D.jsx)(b.a,{id:"uploading"})}),U&&Object(D.jsx)("p",{children:Object(D.jsx)(b.a,{id:"error_while_uploading"})})]})})}),Object(D.jsxs)("div",{className:O.a.actions,children:[Object(D.jsx)(j.a,{disabled:z<=-1,fill:"outline",size:"default",onClick:L,children:Object(D.jsx)(b.a,{id:"prev"})}),Object(D.jsx)(j.a,{disabled:z>=x.length||!!K&&!!K.input&&K.input.required,fill:"outline",size:"default",onClick:J,children:Object(D.jsx)(b.a,{id:"next"})})]})]})}}}]);
//# sourceMappingURL=7.b3a2bb54.chunk.js.map