{"version":3,"sources":["pages/Survey.module.css","components/Question.module.css","components/GeoInput.module.css","hooks/useKeyPress.js","functions/computeHasValue.js","components/GeoInput.js","components/Question.js","questions.yaml","pages/Survey.js"],"names":["module","exports","useKeyPress","keys","callback","useEffect","onKeyup","event","includes","key","window","addEventListener","removeEventListener","computeHasValue","value","hasValue","Set","size","Array","isArray","length","String","isNaN","Object","MapScale","map","useMap","L","control","scale","addTo","MapSearch","withLocalization","getString","onChange","useState","typingTimeout","setTypingTimeout","provider","setProvider","OpenStreetMapProvider","params","email","handleChange","useCallback","clearTimeout","setTimeout","search","query","target","then","result","fitBounds","bounds","lat","y","lng","x","className","classes","searchInput","type","placeholder","MapZoom","handleZoomIn","zoomIn","handleZoomOut","zoomOut","zoomButtonsWrapper","zoomButton","onClick","MapEventHandler","onMap","useMapEvent","geoPrecision","geoShift","GeoInput","defaultValue","setMap","defaultValueLatLng","split","parseFloat","markerPos","setMarkerPos","preciseMarkerPos","setPreciseMarkerPos","rectangle","useRectangle","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","saveMapPos","roundedLat","Math","round","roundedLng","handleMapClick","latlng","handleMap","newMap","mapWrapper","MapContainer","center","zoom","scrollWheelZoom","zoomControl","TileLayer","attribution","url","Circle","radius","pathOptions","fillOpacity","color","Rectangle","fillColor","weight","lineCap","lineJoin","abc","ABC","toUpperCase","keys2listen","fluentByObject","_id","question","description","input","defaultValueObject","onSubmit","inputRef","useRef","firstDefaultValue","writeInDefaultValue","write_in","setValue","writeInValue","setWriteInValue","JSON","stringify","setValueJSON","setValueBoth","newValue","writeInIsActive","setWriteInIsActive","current","blur","required","index","indexOf","options","option","multiple","has","delete","add","oldValue","storeValue","newValueSet","storeGeoValue","storeWriteInValue","handleWriteInFocus","handleWriteInBlur","handleChoiceClick","handleSubmit","focus","input_component","ref","min","onFocus","onBlur","thisOption","title","style","whiteSpace","display","marginBottom","button_key","margin","verticalAlign","fontWeight","fill","filter","Boolean","line","Localized","id","elems","strong","submit_incident","gql","getValueTitle","de","Survey","uploaded","setUploaded","questions","setQuestions","questionsById","setQuestionsById","answers","setAnswers","currentQuestionsIndex","setCurrentQuestionsIndex","useMutation","onCompleted","onError","error","console","submitIncident","mutationLoading","loading","mutationError","a","fetch","questions_path","response","text","data","yaml","load","dataForArray","parse","dataForObject","entries","questionEntry","thisQuestionData","optionsEntry","reduce","obj","load_data","prevQuestion","nextQuestion","toTheBeginning","gotoFirstQuestion","nodeName","handleSendData","answersForSending","values","answer","warn","thisQuestion","variables","properties","ignoreResults","handleDownloadData","answersForDownload","now","Date","toISOString","nowForFilename","replace","textToWrite","fileNameToSaveAs","textFileAsBlob","Blob","downloadLink","document","createElement","download","innerHTML","webkitURL","href","createObjectURL","URL","onclick","parentNode","removeChild","body","appendChild","click","saveTextAsFile","thisValue","join","currentQuestion","answersArray","survey","progress","opacity","content","contentWrapper","rel","actions","disabled"],"mappings":"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","file":"static/js/7.d3ecd5eb.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"survey\":\"Survey_survey__1FA27\",\"progress\":\"Survey_progress__2sfK1\",\"content\":\"Survey_content__3KwW1\",\"contentWrapper\":\"Survey_contentWrapper__n5nmh\",\"actions\":\"Survey_actions__27Ee9\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"question\":\"Question_question__1iSNS\",\"button_key\":\"Question_button_key__1i8i4\",\"option\":\"Question_option__3f0DC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"mapWrapper\":\"GeoInput_mapWrapper__3HwMS\",\"map\":\"GeoInput_map__3L-Nl\",\"searchInput\":\"GeoInput_searchInput__1aYZ2\",\"zoomButtonsWrapper\":\"GeoInput_zoomButtonsWrapper__Nxaw_\",\"zoomButton\":\"GeoInput_zoomButton__n1Agi\"};","import { useEffect } from 'react'\n\nexport default function useKeyPress(keys, callback) {\n  useEffect(() => {\n    function onKeyup(event) {\n      if (keys.includes(event.key)) {\n        callback(event)\n      }\n    }\n    window.addEventListener('keyup', onKeyup)\n    return () => window.removeEventListener('keyup', onKeyup)\n  }, [keys, callback])\n}\n","export default function computeHasValue(value) {\n  let hasValue = false\n  if (typeof value === 'object' && value instanceof Set && value.size > 0) {\n    hasValue = true\n  } else if (Array.isArray(value) && value.length > 0) {\n    hasValue = true\n  } else if ((typeof value === 'string' || value instanceof String) && value.length > 0) {\n    hasValue = true\n  } else if (typeof value === 'number' && !isNaN(value)) {\n    hasValue = true\n  } else if (typeof value === 'object' && value !== null && Object.keys(value).length > 0) {\n    hasValue = true\n  }\n  return hasValue\n}\n","import { useState, useEffect, useCallback } from 'react'\n\nimport { IonButton } from '@ionic/react'\n\nimport { withLocalization } from './fluent/Localized.js'\n\nimport { MapContainer, TileLayer, Circle, Rectangle, useMapEvent, useMap } from 'react-leaflet'\nimport 'leaflet/dist/leaflet.css'\n\nimport { OpenStreetMapProvider } from 'leaflet-geosearch'\n\nimport classes from './GeoInput.module.css'\nimport './GeoInputLeaflet.css'\n\nimport iconRetinaUrl from 'leaflet/dist/images/marker-icon-2x.png'\nimport iconUrl from 'leaflet/dist/images/marker-icon.png'\nimport shadowUrl from 'leaflet/dist/images/marker-shadow.png'\n\nfunction MapScale() {\n  const map = useMap()\n\n  useEffect(() => {\n    window.L.control.scale().addTo(map)\n  }, [map])\n\n  return null\n}\n\nfunction MapSearchTemp({ getString, map, onChange }) {\n  const [typingTimeout, setTypingTimeout] = useState()\n\n  const [provider, setProvider] = useState()\n\n  useEffect(() => {\n    setProvider(new OpenStreetMapProvider({ // TODO: Add more providers as a backup. And propably proxy through our api server.\n      params: {\n        email: 'tech@queerfeindlichkeit.de', // auth for large number of requests\n      },\n    }))\n  }, [setProvider])\n\n  const handleChange = useCallback(event => {\n    clearTimeout(typingTimeout)\n    setTypingTimeout(setTimeout(()=>{\n      if (!!provider && !!map) {\n        provider.search({ query: event.target.value })\n          .then(function (result) {\n            if (result.length > 0) {\n              map.fitBounds(result[0].bounds)\n              onChange({ lat: result[0].y, lng: result[0].x })\n              // map.setView({ lng: result[0].x, lat: result[0].y })\n            }\n          })\n      }\n    }, 500))\n  }, [typingTimeout, setTypingTimeout, provider, map, onChange])\n\n  return <input\n    className={classes.searchInput}\n    type=\"text\"\n    onChange={handleChange}\n    placeholder={getString('placeholder_search')}\n  />\n}\nconst MapSearch = withLocalization(MapSearchTemp)\n\nfunction MapZoom({ map }) {\n  const handleZoomIn = useCallback(event => {\n    if (!!map) {\n      map.zoomIn(1)\n    }\n  }, [map])\n\n  const handleZoomOut = useCallback(event => {\n    if (!!map) {\n      map.zoomOut(1)\n    }\n  }, [map])\n\n  return <div className={classes.zoomButtonsWrapper}>\n    <IonButton className={classes.zoomButton} onClick={handleZoomIn}>+</IonButton>\n    <IonButton className={classes.zoomButton} onClick={handleZoomOut}>-</IonButton>\n  </div>\n}\n\nfunction MapEventHandler({ onMap, onClick }) {\n  const map = useMap()\n\n  useEffect(() => {\n    onMap(map)\n  }, [onMap, map])\n\n  useMapEvent('click', onClick)\n\n  return null\n}\n\nconst geoPrecision = 100\nconst geoShift = 0.5 / geoPrecision\n\nfunction useRectangle({ lat, lng }) {\n  return [\n    [lat - geoShift, lng - geoShift],\n    [lat + geoShift, lng + geoShift],\n  ]\n}\n\nfunction GeoInput({ onChange, defaultValue }) {\n  const [map, setMap] = useState()\n\n  const defaultValueLatLng = (defaultValue || '').split(',').map(value => parseFloat(value))\n\n  const [markerPos, setMarkerPos] = useState({ lat: defaultValueLatLng[0] || 0, lng: defaultValueLatLng[1] || 0 })\n  const [preciseMarkerPos, setPreciseMarkerPos] = useState(markerPos)\n  const rectangle = useRectangle(markerPos)\n\n  useEffect(() => {\n    const L = window.L\n\n    delete L.Icon.Default.prototype._getIconUrl\n\n    L.Icon.Default.mergeOptions({\n      iconRetinaUrl,\n      iconUrl,\n      shadowUrl\n    })\n  }, [])\n\n  const saveMapPos = useCallback(({ lat, lng }) => {\n    let roundedLat = Math.round(lat * geoPrecision) / geoPrecision\n    let roundedLng = Math.round(lng * geoPrecision) / geoPrecision\n\n    if (roundedLat === markerPos.lat && roundedLng === markerPos.lng) {\n      roundedLat = 0\n      roundedLng = 0\n      lat = 0\n      lng = 0\n    }\n\n    setPreciseMarkerPos({ lat, lng })\n    setMarkerPos({ lat: roundedLat, lng: roundedLng })\n\n    if (roundedLat === 0 && roundedLng === 0) {\n      onChange(null)\n    } else {\n      onChange(`${roundedLat}, ${roundedLng}`)\n    }\n  }, [markerPos, setPreciseMarkerPos, setMarkerPos, onChange])\n\n  const handleMapClick = useCallback((event) => {\n    // if (event.originalEvent.target.classList.contains('leaflet-container')) { // check if event is coming from the map\n      let { lat, lng } = event.latlng\n      saveMapPos({ lat, lng })\n    // }\n  }, [saveMapPos])\n\n  const handleMap = useCallback((newMap) => {\n    setMap(newMap)\n  }, [setMap])\n\n  return <div className={classes.mapWrapper}>\n    <MapSearch map={map} onChange={saveMapPos}/>\n    <MapZoom map={map} />\n    <MapContainer\n      className={classes.map}\n      center={[51.2964955, 9.9019876]}\n      zoom={5.5}\n      scrollWheelZoom={false}\n      zoomControl={false}\n    >\n      {/* <TileLayer\n        attribution='© <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n      /> */}\n      {/* <TileLayer\n        attribution='© <a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\" rel=\"noreferrer\">OpenStreetMap</a> contributors | © <a href=\"https://carto.com/attributions\" target=\"_blank\" rel=\"noreferrer\">CARTO</a>'\n        url=\"https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png\"\n        subdomains=\"abcd\"\n        maxZoom={19}\n      /> */}\n      {/* <TileLayer\n        attribution='© <a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\" rel=\"noreferrer\">OpenStreetMap</a> contributors'\n        url=\"http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png\"\n        subdomains=\"ab\"\n        maxZoom={19}\n      /> */}\n      <TileLayer\n        attribution='<a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\" rel=\"noreferrer\">© OpenStreetMap</a> <a href=\"https://www.mapbox.com/about/maps/\" target=\"_blank\" rel=\"noreferrer\">© Mapbox</a>'\n        url=\"https://api.mapbox.com/styles/v1/qiekub/cko1ikam20wgq18p9wd200uy0/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoicWlla3ViIiwiYSI6ImNrbzFpY3NtZjA4dXQyb3M1OGU5czNqZzYifQ.UFFb9Vh5VldqZzdjempXPQ\"\n      />\n\n      {\n        preciseMarkerPos.lat !== markerPos.lat && preciseMarkerPos.lng !== markerPos.lng\n        ? <Circle center={preciseMarkerPos} radius={5} pathOptions={{ fillOpacity: 1, color: 'var(--primary-dark, black)' }} />\n        : null\n      }\n      {\n        markerPos.lat !== 0 && markerPos.lng !== 0\n        ? <Rectangle bounds={rectangle} pathOptions={{ fillColor: 'var(--primary, black)', color: 'var(--primary-dark, black)', fillOpacity: 0.3, weight: 5, lineCap: 'square', lineJoin: 'square' }} />\n        : null\n      }\n      <MapEventHandler onMap={handleMap} onClick={handleMapClick} />\n      <MapScale />\n    </MapContainer>\n  </div>\n}\n\nexport default GeoInput\n","import { useCallback, useEffect, useState, useRef } from 'react'\nimport useKeyPress from '../hooks/useKeyPress.js'\nimport computeHasValue from '../functions/computeHasValue.js'\n\nimport { IonButton } from '@ionic/react'\n\nimport { withLocalization, Localized } from './fluent/Localized.js'\n\nimport classes from './Question.module.css'\nimport GeoInput from './GeoInput.js'\n\nlet abc = 'abcdefghijklmnopqrstuvwxyz'\nconst ABC = abc.toUpperCase().split('')\nabc = abc.split('')\nconst keys2listen = ['Escape', 'Enter', ...abc, ...ABC]\n\nfunction Question({ fluentByObject, getString, _id, question, description, input, defaultValue: defaultValueObject, onSubmit }) {\n  const inputRef = useRef()\n\n  const defaultValue = !!defaultValueObject ? defaultValueObject.value : new Set()\n  let firstDefaultValue = [...defaultValue]\n  if (firstDefaultValue.length > 0) {\n    firstDefaultValue = firstDefaultValue[0]\n  } else {\n    firstDefaultValue = null\n  }\n  const writeInDefaultValue = !!defaultValueObject ? defaultValueObject.write_in : null\n\n  const [value, setValue] = useState(defaultValue)\n  const [writeInValue, setWriteInValue] = useState(writeInDefaultValue)\n\n  const [, setValueJSON] = useState(JSON.stringify([...value]))\n\n  const setValueBoth = useCallback(newValue => {\n    setValue(newValue)\n    setValueJSON(JSON.stringify([...newValue]))\n  }, [setValue, setValueJSON])\n\n  const [writeInIsActive, setWriteInIsActive] = useState(false)\n\n  let hasValue = computeHasValue(value)\n\n  useKeyPress(keys2listen, event => {\n    if (event.key === 'Escape') {\n      if (!!inputRef && !!inputRef.current) {\n        inputRef.current.blur()\n      }\n    } if (\n      event.key === 'Enter'\n      && (!input.required || (input.required && hasValue))\n    ) {\n      if (input.type === 'choice' && hasValue) {\n        onSubmit({\n          _id,\n          value,\n          ...(computeHasValue(writeInValue) ? { write_in: writeInValue } : {})\n        })\n      } else if (\n        input.type === 'number'\n        || input.type === 'short_text'\n        || (input.type === 'long_text' && !writeInIsActive)\n      ) {\n        onSubmit({ _id, value })\n      }\n    } else if (input.type === 'choice' && !writeInIsActive) {\n      let index = abc.indexOf(event.key)\n      if (index <= -1) {\n        index = ABC.indexOf(event.key)\n      }\n      if (index >= 0 && input.options[index]) {\n        const option = input.options[index]._id\n\n        if (input.multiple === true) {\n          const newValue = value\n          if (newValue.has(option)) {\n            newValue.delete(option)\n          } else {\n            newValue.add(option)\n          }\n          setValueBoth(newValue)\n        } else {\n          let oldValue = [...value]\n          if (oldValue.length > 0) {\n            oldValue = oldValue[0]\n          } else {\n            oldValue = null\n          }\n\n          const newValue = new Set()\n          if (option !== oldValue) {\n            newValue.add(option)\n          }\n          setValueBoth(newValue)\n\n          if (!!onSubmit && option !== oldValue) {\n            onSubmit({\n              _id,\n              value: newValue,\n              ...(computeHasValue(writeInValue) ? { write_in: writeInValue } : {})\n            })\n          }\n        }\n      }\n    }\n  })\n\n  const storeValue = useCallback(event => {\n    let newValue = event.target.value\n\n    if (input.type === 'number') {\n      newValue = parseFloat(newValue)\n      if (isNaN(newValue)) {\n        newValue = null\n      }\n    }\n\n    const newValueSet = new Set()\n    newValueSet.add(newValue)\n    setValueBoth(newValueSet)\n  }, [setValueBoth, input.type])\n\n  const storeGeoValue = useCallback(value => {\n    const newValueSet = new Set()\n    if (!!value) {\n      newValueSet.add(value)\n    }\n    setValueBoth(newValueSet)\n  }, [setValueBoth])\n\n  // START write in\n  const storeWriteInValue = useCallback(event => {\n    let option = event.target.value\n\n    if (input.type === 'number' && option !== '') {\n      option = parseFloat(option)\n      if (isNaN(option)) {\n        option = null\n      }\n    }\n\n    if (input.multiple === true) {\n      const newValue = value\n      newValue.delete(writeInValue) // delete old value\n      if (newValue.has(option)) {\n        newValue.delete(option)\n      } else if (option !== '') {\n        newValue.add(option)\n      }\n      setValueBoth(newValue)\n    } else {\n      const newValue = new Set()\n      if (option !== '') {\n        newValue.add(option)\n      }\n      setValueBoth(newValue)\n    }\n\n    setWriteInValue(option)\n  }, [input.type, input.multiple, value, writeInValue, setValueBoth, setWriteInValue])\n\n  const handleWriteInFocus = useCallback(() => {\n    setWriteInIsActive(true)\n  }, [setWriteInIsActive])\n\n  const handleWriteInBlur = useCallback(() => {\n    setWriteInIsActive(false)\n  }, [setWriteInIsActive])\n  // END write in\n\n  const handleChoiceClick = useCallback(option => {\n    if (input.multiple === true) {\n      const newValue = value\n      if (newValue.has(option)) {\n        newValue.delete(option)\n      } else {\n        newValue.add(option)\n      }\n      setValueBoth(newValue)\n    } else {\n      let oldValue = [...value]\n      if (oldValue.length > 0) {\n        oldValue = oldValue[0]\n      } else {\n        oldValue = null\n      }\n\n      const newValue = new Set()\n      if (option !== oldValue) {\n        newValue.add(option)\n      }\n      setValueBoth(newValue)\n\n      if (!!onSubmit && option !== oldValue) {\n        onSubmit({\n          _id,\n          value: newValue,\n          ...(computeHasValue(writeInValue) ? { write_in: writeInValue } : {})\n        })\n      }\n    }\n  }, [value, setValueBoth, onSubmit, input.multiple, _id, writeInValue])\n\n  const handleSubmit = useCallback(() => {\n    if (!!onSubmit && (!input.required || (input.required && hasValue))) {\n      onSubmit({\n        _id,\n        value,\n        ...(computeHasValue(writeInValue) ? { write_in: writeInValue } : {})\n      })\n    }\n  }, [input, hasValue, onSubmit, _id, value, writeInValue])\n\n  // auto focus input field\n  useEffect(() => {\n    if (input.type !== 'choice' && !!inputRef && !!inputRef.current && !hasValue) {\n      inputRef.current.focus()\n    }\n  }, [input.type, inputRef, hasValue])\n\n  // do nothing if no question supplied\n  if (!(!!_id)) {\n    return null\n  }\n\n  let input_component = null\n  if (input.type === 'number') {\n    input_component = <input ref={inputRef} type=\"number\" placeholder={getString('placeholder_number')} min={0} onChange={storeValue} defaultValue={firstDefaultValue} />\n  } else if (input.type === 'short_text' || input.type === 'date') { // TODO: date sollte ein eigenes echtes input sein, das direkt überprüft, ob es ein echtes Datum ist.\n    input_component = <input ref={inputRef} type=\"text\" placeholder={getString('placeholder_short_text')} onChange={storeValue} defaultValue={firstDefaultValue} />\n  } else if (input.type === 'long_text') {\n    input_component = <textarea\n      ref={inputRef}\n      onChange={storeValue}\n      onFocus={handleWriteInFocus}\n      onBlur={handleWriteInBlur}\n      defaultValue={firstDefaultValue}\n      placeholder={getString('placeholder_long_text')}\n    />\n  } else if (input.type === 'choice') {\n    input_component = <>\n      {\n        !!input.options\n          ? input.options.map((option, index) => {\n            const thisOption = fluentByObject(option)\n\n            let title = null\n            let description = null\n\n            if (typeof thisOption === 'string' || thisOption instanceof String) {\n              title = thisOption\n            } else {\n              if (!!thisOption.title) {\n                title = thisOption.title\n              }\n              if (!!thisOption.description) {\n                description = thisOption.description\n              }\n            }\n\n            if (title === null) {\n              return null\n            }\n\n            return <div\n                key={option._id}\n                className=\"body2\"\n                style={{ whiteSpace: 'nowrap', display: 'flex', marginBottom: '8px' }}\n              >\n              <span className={classes.button_key}>\n                {ABC[index]}\n              </span>\n              <p className=\"body2\" style={{ whiteSpace: 'normal', margin: '0' }}>\n                <IonButton\n                  style={{ verticalAlign: 'middle', margin: '0 0 2px 0', fontWeight: 'bold' }}\n                  fill={value.has(option._id) ? 'solid' : 'outline'}\n                  size=\"small\"\n                  onClick={() => handleChoiceClick(option._id)}\n                >\n                  {title}\n                </IonButton>\n                {\n                  description !== null\n                  ? <span style={{ margin: '0 0 0 8px' }}>{description}</span>\n                  : null\n                }\n              </p>\n            </div>\n          })\n        : null\n      }\n      {\n        !!input.write_in\n          ? <div>\n            <input\n              ref={inputRef}\n              type=\"text\"\n              placeholder={getString('placeholder_write_in_short_text')}\n              onChange={storeWriteInValue}\n              onFocus={handleWriteInFocus}\n              onBlur={handleWriteInBlur}\n              defaultValue={writeInDefaultValue}\n            />\n          </div>\n        : null\n      }\n    </>\n  } else if (input.type === 'geo') {\n    input_component = <>\n      <GeoInput onChange={storeGeoValue} defaultValue={firstDefaultValue} />\n      <p>{value}</p>\n    </>\n  }\n\n  return (\n    <div className={classes.question}>\n      <h3 className=\"subtitle1\">{fluentByObject(question)}</h3>\n      {!!description ? fluentByObject(description, '').split('\\n').filter(Boolean).map(line => <p key={line}>{line}</p>) : null}\n      {input.required ? <p style={{ color: 'darkred', fontWeight: 'bold' }}><Localized id=\"required_question\" /></p> : null}\n      {input_component}\n      {\n        (hasValue || !input.required)\n        && (input.type !== 'choice' || input.write_in === true)\n          ? <p>\n            <IonButton style={{ verticalAlign: 'middle', margin: '0 16px 0 0' }} size=\"default\" onClick={handleSubmit}><Localized id=\"submit_question\" /></IonButton>\n            {\n              (\n                input.type === 'number'\n                || input.type === 'short_text'\n                || (input.type === 'long_text' && !writeInIsActive)\n                || (input.type === 'choice' && input.write_in === true && hasValue)\n              )\n              && (!input.required || (input.required && hasValue))\n              ? <span style={{ verticalAlign: 'middle' }}>\n                <Localized id=\"press_enter_info\" elems={{strong: <strong/>}} />\n              </span>\n              : null\n            }\n          </p>\n          : null\n      }\n    </div>\n  )\n}\n\nexport default withLocalization(Question)\n","export default __webpack_public_path__ + \"static/media/questions.b2c86f2e.yaml\";","import { useEffect, useState, useCallback } from 'react'\nimport yaml from 'js-yaml'\n\nimport { IonButton } from '@ionic/react'\n\nimport { Localized } from '../components/fluent/Localized.js'\n\nimport classes from './Survey.module.css'\nimport Question from '../components/Question.js'\nimport useKeyPress from '../hooks/useKeyPress.js'\nimport computeHasValue from '../functions/computeHasValue.js'\n\nimport questions_path from '../questions.yaml'\n\nimport { gql, useMutation } from '@apollo/client'\n\nconst submit_incident = gql`\n  mutation ($text: String, $properties: JSONObject) {\n    incident(text: $text, properties: $properties)\n  }\n`\n\nfunction saveTextAsFile(textToWrite, fileNameToSaveAs) {\n  // source: https://stackoverflow.com/questions/609530/download-textarea-contents-as-a-file-using-only-javascript-no-server-side\n  var textFileAsBlob = new Blob([textToWrite], { type: 'text/plain' })\n  var downloadLink = document.createElement('a')\n  downloadLink.download = fileNameToSaveAs\n  downloadLink.innerHTML = 'Download File'\n  if (window.webkitURL != null) {\n    // Chrome allows the link to be clicked\n    // without actually adding it to the DOM.\n    downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob)\n  }\n  else {\n    // Firefox requires the link to be added to the DOM\n    // before it can be clicked.\n    downloadLink.href = window.URL.createObjectURL(textFileAsBlob)\n    downloadLink.onclick = function () {\n      downloadLink.parentNode.removeChild(downloadLink)\n    }\n    downloadLink.style.display = 'none'\n    document.body.appendChild(downloadLink)\n  }\n\n  downloadLink.click()\n}\n\nconst mainTextQuestion = 'what_happened'\n\nfunction getValueTitle(value, options) {\n  const thisOption = !!options && !!options[value] ? options[value].de : value\n\n  let title = null\n\n  if (typeof thisOption === 'string' || thisOption instanceof String) {\n    title = thisOption\n  } else {\n    if (!!thisOption.title) {\n      title = thisOption.title\n    }\n  }\n\n  return title\n}\n\nfunction Survey() {\n  const [uploaded, setUploaded] = useState(false)\n  const [questions, setQuestions] = useState([])\n  const [questionsById, setQuestionsById] = useState({})\n  const [answers, setAnswers] = useState({})\n  const [currentQuestionsIndex, setCurrentQuestionsIndex] = useState(-1)\n\n  const [submitIncident, { loading: mutationLoading, error: mutationError }] = useMutation(submit_incident, {\n    onCompleted() {\n      setUploaded(true)\n    },\n    onError(error) {\n      console.error(error)\n    }\n  })\n\n  useEffect(() => {\n    async function load_data() {\n      let response = await fetch(questions_path)\n      let text = await response.text() // read response body as text\n\n      const data = yaml.load(text)\n\n      if (!!data && !!data.questions) {\n        const dataForArray = JSON.parse(JSON.stringify(data)) // TODO: Please check, why data needs to be cloned!\n        const dataForObject = JSON.parse(JSON.stringify(data)) // TODO: Please check, why data needs to be cloned!\n\n        setQuestions( // TODO: Somewhere in the following lines, data is would get overwritten if not cloned.\n          Object.entries(dataForArray.questions)\n          .map(questionEntry => {\n            let thisQuestionData = questionEntry[1]\n\n            if (\n              !!thisQuestionData.input\n              && !!thisQuestionData.input.options\n            ) {\n              thisQuestionData.input.options = Object.entries(thisQuestionData.input.options)\n                .map(optionsEntry => ({\n                  _id: optionsEntry[0],\n                  ...optionsEntry[1]\n                }))\n            }\n\n            return {\n              _id: questionEntry[0],\n              ...thisQuestionData\n            }\n          })\n        )\n\n        setQuestionsById(\n          Object.entries(dataForObject.questions)\n          .reduce((obj, questionEntry) => {\n            const _id = questionEntry[0]\n            let thisQuestionData = questionEntry[1]\n\n            if (!thisQuestionData.input) {\n              thisQuestionData.input = {}\n            }\n            if (!thisQuestionData.input.options) {\n              thisQuestionData.input.options = {}\n            }\n\n            obj[_id] = {\n              _id,\n              ...thisQuestionData\n            }\n\n            return obj\n          }, {})\n        )\n      } else {\n        setQuestionsById({})\n        setQuestions([])\n      }\n    }\n    load_data()\n  }, [setQuestions, setQuestionsById])\n\n  const handleChange = useCallback(data => {\n    if (!!data && !!data._id) {\n      if (computeHasValue(data.value)) {\n        answers[data._id] = data\n      } else if (!!answers[data._id]){\n        delete answers[data._id]\n      }\n      setAnswers(answers)\n    }\n    if (currentQuestionsIndex <= questions.length) {\n      setCurrentQuestionsIndex(currentQuestionsIndex + 1)\n    }\n  }, [setAnswers, answers, setCurrentQuestionsIndex, currentQuestionsIndex, questions.length])\n\n  const prevQuestion = useCallback(() => {\n    if (currentQuestionsIndex > -1) {\n      setCurrentQuestionsIndex(currentQuestionsIndex - 1)\n    }\n  }, [setCurrentQuestionsIndex, currentQuestionsIndex])\n\n  const nextQuestion = useCallback(() => {\n    if (currentQuestionsIndex <= questions.length) {\n      if (currentQuestionsIndex <= 0) { // if -1 (intro)\n        setCurrentQuestionsIndex(currentQuestionsIndex + 1)\n      } else { // if between 0 and questions.length\n        const currentQuestion = questions[currentQuestionsIndex]\n        if (!currentQuestion.input.required) {\n          setCurrentQuestionsIndex(currentQuestionsIndex + 1)\n        }\n      }\n    }\n  }, [setCurrentQuestionsIndex, currentQuestionsIndex, questions])\n\n  const toTheBeginning = useCallback(() => {\n    setCurrentQuestionsIndex(-1)\n  }, [setCurrentQuestionsIndex])\n\n  const gotoFirstQuestion = useCallback(() => {\n    setCurrentQuestionsIndex(0)\n  }, [setCurrentQuestionsIndex])\n\n  useKeyPress(['ArrowRight', 'ArrowLeft'], event => {\n    if (event.target.nodeName === 'BODY') {\n      if (event.key === 'ArrowUp' || event.key === 'ArrowLeft') {\n        prevQuestion()\n      } else {\n        nextQuestion()\n      }\n    }\n  })\n\n  const handleSendData = useCallback(() => {\n    let answersForSending = Object.values(answers)\n      .filter(answer => answer._id !== null && answer.value !== null)\n\n    if (answersForSending.length === 0) {\n      console.warn('⚠️ Keine Angaben. Unnötig abzusenden. But this if shoul\\'nt get called anyway.')\n    } else {\n      answersForSending = answersForSending\n        .reduce((obj, answer) => {\n          const thisQuestion = questionsById[answer._id]\n\n          const value = [...answer.value]\n          if (thisQuestion.input.multiple === true) {\n            obj[answer._id] = value\n          } else {\n            obj[answer._id] = value[0]\n          }\n          return obj\n        }, {})\n\n      const text = answersForSending[mainTextQuestion] || ''\n      delete answersForSending[mainTextQuestion]\n\n      submitIncident({\n        variables: {\n          text,\n          properties: answersForSending\n        },\n        ignoreResults: false\n      })\n    }\n  }, [answers, questionsById, submitIncident])\n\n  const handleDownloadData = useCallback(() => {\n    let answersForDownload = Object.values(answers)\n      .filter(answer => answer._id !== null && answer.value !== null)\n\n    if (answersForDownload.length === 0) {\n      console.warn('⚠️ Keine Angaben. Unnötig runterzuladen. But this if shoul\\'nt get called anyway.')\n    } else {\n      let now = new Date().toISOString()\n      now = now.replace(/T/g, ' ')\n      const nowForFilename = now.replace(/(:|\\.)/g, '-')\n\n      answersForDownload = `# Dein Vorfall (${now})\\n\\n${\n        answersForDownload.map(answer => {\n          const thisQuestion = questionsById[answer._id]\n          return `## ${\n            thisQuestion.question.de\n          }\\n\\n${\n            thisQuestion.input.multiple === true\n            ? [...answer.value].map(thisValue => `- ${getValueTitle(thisValue, thisQuestion.input.options)}`).join('\\n')\n            : getValueTitle([...answer.value][0], thisQuestion.input.options)\n          }`\n        }).join('\\n\\n')\n      }`\n\n      saveTextAsFile(answersForDownload, `Dein Vorfall ${nowForFilename}.md.txt`)\n    }\n  }, [answers, questionsById])\n\n  if (!(!!questions)) {\n    return null\n  }\n\n  const currentQuestion = questions[currentQuestionsIndex]\n\n  const answersArray = Object.values(answers)\n    .filter(answer => answer.value !== null)\n\n  return (\n    <div className={classes.survey}>\n      <div className={classes.progress} style={{\n        '--width': `${((currentQuestionsIndex) / questions.length) * 100}%`,\n        opacity: (currentQuestionsIndex <= 0 ? 0 : 1)\n      }} />\n      <div className={classes.content}>\n        <div className={classes.contentWrapper}>\n          {\n            currentQuestionsIndex === -1\n            ? <>\n                <h3>Vorfall melden</h3>\n                <p>Hier kannst du einen queerfeindlichen Vorfall melden.</p>\n                <p>Deine Daten dienen lediglich zur statistischen Auswertung. Sie führen nicht zu einer Anzeige bei der Polizei. Wir speichern deine Daten anonymiesiert.</p>\n                <p>Bei Fragen kannst du dich an <a href=\"mailto:info@queerfeindlichkeit.de\" target=\"_blank\" rel=\"noreferrer\">info@queerfeindlichkeit.de</a> wenden. Oder uns bei Instagram eine Nachricht schichen: <a href=\"https://instagram.com/queerfeindlichkeit\" target=\"_blank\" rel=\"noreferrer\">@queerfeindlichkeit</a></p>\n                <IonButton size=\"default\" onClick={gotoFirstQuestion}><Localized id=\"start_survey\" /></IonButton>\n            </>\n            : (\n              !!currentQuestion\n              ? <>\n                <Question\n                  key={currentQuestion._id}\n                  onSubmit={handleChange}\n                  defaultValue={answers[currentQuestion._id] || null}\n                  {...currentQuestion}\n                />\n              </>\n              : (\n                answersArray.length === 0\n                ? <>\n                  <h3>Hmmm…</h3>\n                  <p>Du hast keine Angaben gemacht. Beschreib deinen Vorfall bitte etwas detailierter.</p>\n                  <IonButton size=\"default\" onClick={toTheBeginning}><Localized id=\"back_to_beginning\" /></IonButton>\n                </>\n                : (\n                  uploaded\n                  ? <>\n                    <h3>Vielen Dank!</h3>\n                    <p>Dein Vorfall wurde hochgeladen.</p>\n                    <p><strong>Vielen Dank, dass Du hilfst Queerfeindlichkeit sichtbar zu machen!</strong></p>\n                            <p>Du möchtest wissen, wie es weitergeht? Auf <a href=\"https://www.instagram.com/queerfeindlichkeit/\" target=\"_blank\" rel=\"noreferrer\">Instagram</a> und  <a href=\"https://twitter.com/anyway_koeln\" target=\"_blank\" rel=\"noreferrer\">Twitter</a> veröffentlichen wir Daten und helfen dir gegen Queerfeindlichkeit anzukommen.</p>\n                    <hr />\n                    <p>Hier kannst du dir noch Deine Daten abspeichern:</p>\n                    <IonButton size=\"default\" onClick={handleDownloadData}><Localized id=\"download_your_incident_data\" /></IonButton>\n                  </>\n                  : <>\n                    <h3>Deine Angaben</h3>\n                    <p>Hier kannst du nochmal über deine Angaben drüber schauen.<br />Geh gerne zurück um etwas zu koorigieren.</p>\n                    <p>Wenn du zufrieden bist, klick unten auf <strong>„Vorfall eintragen”</strong>.</p>\n                    <p>Deine Daten kannst du dir unter <strong>„Daten runterladen”</strong>abspeichern.</p>\n                    <hr />\n                    {\n                      answersArray.map(answer => {\n                        const thisQuestion = questionsById[answer._id]\n\n                        return <div key={answer._id}>\n                          <div className=\"subtitle1\">{thisQuestion.question.de}</div>\n                          {\n                            thisQuestion.input.multiple === true\n                              ? <p><ul>\n                                {[...answer.value].map(thisValue => <li>{getValueTitle(thisValue, thisQuestion.input.options)}</li>)}\n                              </ul></p>\n                              : getValueTitle([...answer.value][0], thisQuestion.input.options)\n                                .split('\\n')\n                                .map(line => <p key={line}>{line}</p>)\n                          }\n                        </div>\n                      })\n                    }\n                    <hr />\n                    <IonButton fill=\"outline\" size=\"default\" onClick={handleDownloadData}><Localized id=\"download_your_incident_data\" /></IonButton>\n                    <IonButton size=\"default\" onClick={handleSendData}><Localized id=\"submit_incident\" /></IonButton>\n                    {mutationLoading && <p><Localized id=\"uploading\" /></p>}\n                    {mutationError && <p><Localized id=\"error_while_uploading\" /></p>}\n                  </>\n                )\n              )\n            )\n          }\n        </div>\n      </div>\n      <div className={classes.actions}>\n        <IonButton disabled={currentQuestionsIndex <= -1} fill=\"outline\" size=\"default\" onClick={prevQuestion}>\n          <Localized id=\"prev\" />\n        </IonButton>\n        <IonButton disabled={currentQuestionsIndex >= questions.length || (!!currentQuestion && !!currentQuestion.input && currentQuestion.input.required)} fill=\"outline\" size=\"default\" onClick={nextQuestion}>\n          <Localized id=\"next\" />\n        </IonButton>\n      </div>\n    </div>\n  )\n}\n\nexport default Survey\n"],"sourceRoot":""}