(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[7],{225:function(e,t,n){e.exports={survey:"Survey_survey__1FA27",progress:"Survey_progress__2sfK1",content:"Survey_content__3KwW1",contentWrapper:"Survey_contentWrapper__n5nmh",actions:"Survey_actions__27Ee9"}},226:function(e,t,n){e.exports={question:"Question_question__1iSNS",button_key:"Question_button_key__1i8i4",option:"Question_option__3f0DC"}},229:function(e,t,n){e.exports={mapWrapper:"GeoInput_mapWrapper__3HwMS",map:"GeoInput_map__3L-Nl",searchInput:"GeoInput_searchInput__1aYZ2",zoomButtonsWrapper:"GeoInput_zoomButtonsWrapper__Nxaw_",zoomButton:"GeoInput_zoomButton__n1Agi"}},230:function(e,t,n){},259:function(e,t,n){"use strict";n.r(t);var i=n(47),a=n(10),c=n.n(a),r=n(20),l=n(21),s=n(11),u=n(223),o=n(0),d=n(224),j=n(49),b=n(93),p=n(225),h=n.n(p);function O(e,t){Object(o.useEffect)((function(){function n(n){e.includes(n.key)&&t(n)}return window.addEventListener("keyup",n),function(){return window.removeEventListener("keyup",n)}}),[e,t])}function f(e){var t=!1;return"object"===typeof e&&e instanceof Set&&e.size>0||Array.isArray(e)&&e.length>0||("string"===typeof e||e instanceof String)&&e.length>0?t=!0:"number"!==typeof e||isNaN(e)?"object"===typeof e&&null!==e&&Object.keys(e).length>0&&(t=!0):t=!0,t}var m=n(226),x=n.n(m),g=n(251),_=n(252),v=n(264),y=n(265),k=n(253),w=(n(227),n(228)),C=n(229),S=n.n(C),q=(n(230),n(231)),N=n(232),z=n(233),D=n(3);function A(){var e=Object(g.a)();return Object(o.useEffect)((function(){window.L.control.scale().addTo(e)}),[e]),null}var V=Object(b.b)((function(e){var t=e.getString,n=e.map,i=e.onChange,a=Object(o.useState)(),c=Object(s.a)(a,2),r=c[0],l=c[1],u=Object(o.useState)(),d=Object(s.a)(u,2),j=d[0],b=d[1];Object(o.useEffect)((function(){b(new w.a({params:{email:"tech@queerfeindlichkeit.de"}}))}),[b]);var p=Object(o.useCallback)((function(e){clearTimeout(r),l(setTimeout((function(){j&&n&&j.search({query:e.target.value}).then((function(e){e.length>0&&(n.fitBounds(e[0].bounds),i({lat:e[0].y,lng:e[0].x}))}))}),500))}),[r,l,j,n,i]);return Object(D.jsx)("input",{className:S.a.searchInput,type:"text",onChange:p,placeholder:t("placeholder_search")})}));function B(e){var t=e.map,n=Object(o.useCallback)((function(e){t&&t.zoomIn(1)}),[t]),i=Object(o.useCallback)((function(e){t&&t.zoomOut(1)}),[t]);return Object(D.jsxs)("div",{className:S.a.zoomButtonsWrapper,children:[Object(D.jsx)(j.a,{className:S.a.zoomButton,onClick:n,children:"+"}),Object(D.jsx)(j.a,{className:S.a.zoomButton,onClick:i,children:"-"})]})}function I(e){var t=e.onMap,n=e.onClick,i=Object(g.a)();return Object(o.useEffect)((function(){t(i)}),[t,i]),Object(g.b)("click",n),null}var F=100,E=.005;var W=function(e){var t=e.onChange,n=e.defaultValue,i=Object(o.useState)(),a=Object(s.a)(i,2),c=a[0],r=a[1],l=(n||"").split(",").map((function(e){return parseFloat(e)})),u=Object(o.useState)({lat:l[0]||0,lng:l[1]||0}),d=Object(s.a)(u,2),j=d[0],b=d[1],p=Object(o.useState)(j),h=Object(s.a)(p,2),O=h[0],f=h[1],m=function(e){var t=e.lat,n=e.lng;return[[t-E,n-E],[t+E,n+E]]}(j);Object(o.useEffect)((function(){var e=window.L;delete e.Icon.Default.prototype._getIconUrl,e.Icon.Default.mergeOptions({iconRetinaUrl:q.a,iconUrl:N.a,shadowUrl:z.a})}),[]);var x=Object(o.useCallback)((function(e){var n=e.lat,i=e.lng,a=Math.round(n*F)/F,c=Math.round(i*F)/F;a===j.lat&&c===j.lng&&(a=0,c=0,n=0,i=0),f({lat:n,lng:i}),b({lat:a,lng:c}),t(0===a&&0===c?null:"".concat(a,", ").concat(c))}),[j,f,b,t]),g=Object(o.useCallback)((function(e){var t=e.latlng,n=t.lat,i=t.lng;x({lat:n,lng:i})}),[x]),w=Object(o.useCallback)((function(e){r(e)}),[r]);return Object(D.jsxs)("div",{className:S.a.mapWrapper,children:[Object(D.jsx)(V,{map:c,onChange:x}),Object(D.jsx)(B,{map:c}),Object(D.jsxs)(_.a,{className:S.a.map,center:[51.2964955,9.9019876],zoom:5.5,scrollWheelZoom:!1,zoomControl:!1,children:[Object(D.jsx)(v.a,{attribution:'<a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noreferrer">\xa9 OpenStreetMap</a> <a href="https://www.mapbox.com/about/maps/" target="_blank" rel="noreferrer">\xa9 Mapbox</a>',url:"https://api.mapbox.com/styles/v1/qiekub/cko1ikam20wgq18p9wd200uy0/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoicWlla3ViIiwiYSI6ImNrbzFpY3NtZjA4dXQyb3M1OGU5czNqZzYifQ.UFFb9Vh5VldqZzdjempXPQ"}),O.lat!==j.lat&&O.lng!==j.lng?Object(D.jsx)(y.a,{center:O,radius:5,pathOptions:{fillOpacity:1,color:"var(--primary-dark, black)"}}):null,0!==j.lat&&0!==j.lng?Object(D.jsx)(k.a,{bounds:m,pathOptions:{fillColor:"var(--primary, black)",color:"var(--primary-dark, black)",fillOpacity:.3,weight:5,lineCap:"square",lineJoin:"square"}}):null,Object(D.jsx)(I,{onMap:w,onClick:g}),Object(D.jsx)(A,{})]})]})},U="abcdefghijklmnopqrstuvwxyz",L=U.toUpperCase().split("");U=U.split("");var J=["Escape","Enter"].concat(Object(i.a)(U),Object(i.a)(L));var M,R=Object(b.b)((function(e){var t=e.fluentByObject,n=e.getString,a=e._id,c=e.question,l=e.description,u=e.input,d=e.defaultValue,p=e.onSubmit,h=Object(o.useRef)(),m=d?d.value:new Set,g=Object(i.a)(m);g=g.length>0?g[0]:null;var _=d?d.write_in:null,v=Object(o.useState)(m),y=Object(s.a)(v,2),k=y[0],w=y[1],C=Object(o.useState)(_),S=Object(s.a)(C,2),q=S[0],N=S[1],z=Object(o.useState)(JSON.stringify(Object(i.a)(k))),A=Object(s.a)(z,2)[1],V=Object(o.useCallback)((function(e){w(e),A(JSON.stringify(Object(i.a)(e)))}),[w,A]),B=Object(o.useState)(!1),I=Object(s.a)(B,2),F=I[0],E=I[1],M=f(k);O(J,(function(e){if("Escape"===e.key&&h&&h.current&&h.current.blur(),"Enter"===e.key&&(!u.required||u.required&&M))"choice"===u.type&&M?p(Object(r.a)({_id:a,value:k},f(q)?{write_in:q}:{})):("number"===u.type||"short_text"===u.type||"long_text"===u.type&&!F)&&p({_id:a,value:k});else if("choice"===u.type&&!F){var t=U.indexOf(e.key);if(t<=-1&&(t=L.indexOf(e.key)),t>=0&&u.options[t]){var n=u.options[t]._id;if(!0===u.multiple){var c=k;c.has(n)?c.delete(n):c.add(n),V(c)}else{var l=Object(i.a)(k);l=l.length>0?l[0]:null;var s=new Set;n!==l&&s.add(n),V(s),p&&n!==l&&p(Object(r.a)({_id:a,value:s},f(q)?{write_in:q}:{}))}}}}));var R=Object(o.useCallback)((function(e){var t=e.target.value;"number"===u.type&&(t=parseFloat(t),isNaN(t)&&(t=null));var n=new Set;n.add(t),V(n)}),[V,u.type]),Q=Object(o.useCallback)((function(e){var t=new Set;e&&t.add(e),V(t)}),[V]),G=Object(o.useCallback)((function(e){var t=e.target.value;if("number"===u.type&&""!==t&&(t=parseFloat(t),isNaN(t)&&(t=null)),!0===u.multiple){var n=k;n.delete(q),n.has(t)?n.delete(t):""!==t&&n.add(t),V(n)}else{var i=new Set;""!==t&&i.add(t),V(i)}N(t)}),[u.type,u.multiple,k,q,V,N]),H=Object(o.useCallback)((function(){E(!0)}),[E]),T=Object(o.useCallback)((function(){E(!1)}),[E]),Y=Object(o.useCallback)((function(e){if(!0===u.multiple){var t=k;t.has(e)?t.delete(e):t.add(e),V(t)}else{var n=Object(i.a)(k);n=n.length>0?n[0]:null;var c=new Set;e!==n&&c.add(e),V(c),p&&e!==n&&p(Object(r.a)({_id:a,value:c},f(q)?{write_in:q}:{}))}}),[k,V,p,u.multiple,a,q]),Z=Object(o.useCallback)((function(){p&&(!u.required||u.required&&M)&&p(Object(r.a)({_id:a,value:k},f(q)?{write_in:q}:{}))}),[u,M,p,a,k,q]);if(Object(o.useEffect)((function(){"choice"!==u.type&&h&&h.current&&!M&&h.current.focus()}),[u.type,h,M]),!a)return null;var K=null;return"number"===u.type?K=Object(D.jsx)("input",{ref:h,type:"number",placeholder:n("placeholder_number"),min:0,onChange:R,defaultValue:g}):"short_text"===u.type||"date"===u.type?K=Object(D.jsx)("input",{ref:h,type:"text",placeholder:n("placeholder_short_text"),onChange:R,defaultValue:g}):"long_text"===u.type?K=Object(D.jsx)("textarea",{ref:h,onChange:R,onFocus:H,onBlur:T,defaultValue:g,placeholder:n("placeholder_long_text")}):"choice"===u.type?K=Object(D.jsxs)(D.Fragment,{children:[u.options?u.options.map((function(e,n){var i=t(e),a=null,c=null;return"string"===typeof i||i instanceof String?a=i:(i.title&&(a=i.title),i.description&&(c=i.description)),null===a?null:Object(D.jsxs)("div",{className:"body2",style:{whiteSpace:"nowrap",display:"flex",marginBottom:"8px"},children:[Object(D.jsx)("span",{className:x.a.button_key,children:L[n]}),Object(D.jsxs)("p",{className:"body2",style:{whiteSpace:"normal",margin:"0"},children:[Object(D.jsx)(j.a,{style:{verticalAlign:"middle",margin:"0 0 2px 0",fontWeight:"bold"},fill:k.has(e._id)?"solid":"outline",size:"small",onClick:function(){return Y(e._id)},children:a}),null!==c?Object(D.jsx)("span",{style:{margin:"0 0 0 8px"},children:c}):null]})]},e._id)})):null,u.write_in?Object(D.jsx)("div",{children:Object(D.jsx)("input",{ref:h,type:"text",placeholder:n("placeholder_write_in_short_text"),onChange:G,onFocus:H,onBlur:T,defaultValue:_})}):null]}):"geo"===u.type&&(K=Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(W,{onChange:Q,defaultValue:g}),Object(D.jsx)("p",{children:k})]})),Object(D.jsxs)("div",{className:x.a.question,children:[Object(D.jsx)("h3",{className:"subtitle1",children:t(c)}),l?t(l,"").split("\n").filter(Boolean).map((function(e){return Object(D.jsx)("p",{children:e},e)})):null,u.required?Object(D.jsx)("p",{style:{color:"darkred",fontWeight:"bold"},children:Object(D.jsx)(b.a,{id:"required_question"})}):null,K,!M&&u.required||"choice"===u.type&&!0!==u.write_in?null:Object(D.jsxs)("p",{children:[Object(D.jsx)(j.a,{style:{verticalAlign:"middle",margin:"0 16px 0 0"},size:"default",onClick:Z,children:Object(D.jsx)(b.a,{id:"submit_question"})}),("number"===u.type||"short_text"===u.type||"long_text"===u.type&&!F||"choice"===u.type&&!0===u.write_in&&M)&&(!u.required||u.required&&M)?Object(D.jsx)("span",{style:{verticalAlign:"middle"},children:Object(D.jsx)(b.a,{id:"press_enter_info",elems:{strong:Object(D.jsx)("strong",{})}})}):null]})]})})),Q=n.p+"static/media/questions.b2c86f2e.yaml",G=n(84),H=Object(G.gql)(M||(M=Object(u.a)(["\n  mutation ($text: String, $properties: JSONObject) {\n    incident(text: $text, properties: $properties)\n  }\n"])));function T(e,t){var n=t&&t[e]?t[e].de:e,i=null;return"string"===typeof n||n instanceof String?i=n:n.title&&(i=n.title),i}t.default=function(){var e=Object(o.useState)(!1),t=Object(s.a)(e,2),n=t[0],a=t[1],u=Object(o.useState)([]),p=Object(s.a)(u,2),m=p[0],x=p[1],g=Object(o.useState)({}),_=Object(s.a)(g,2),v=_[0],y=_[1],k=Object(o.useState)({}),w=Object(s.a)(k,2),C=w[0],S=w[1],q=Object(o.useState)(-1),N=Object(s.a)(q,2),z=N[0],A=N[1],V=Object(G.useMutation)(H,{onCompleted:function(){a(!0)},onError:function(e){console.error(e)}}),B=Object(s.a)(V,2),I=B[0],F=B[1],E=F.loading,W=F.error;Object(o.useEffect)((function(){function e(){return(e=Object(l.a)(c.a.mark((function e(){var t,n,i,a,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(Q);case 2:return t=e.sent,e.next=5,t.text();case 5:n=e.sent,(i=d.a.load(n))&&i.questions?(a=JSON.parse(JSON.stringify(i)),l=JSON.parse(JSON.stringify(i)),x(Object.entries(a.questions).map((function(e){var t=e[1];return t.input&&t.input.options&&(t.input.options=Object.entries(t.input.options).map((function(e){return Object(r.a)({_id:e[0]},e[1])}))),Object(r.a)({_id:e[0]},t)}))),y(Object.entries(l.questions).reduce((function(e,t){var n=t[0],i=t[1];return i.input||(i.input={}),i.input.options||(i.input.options={}),e[n]=Object(r.a)({_id:n},i),e}),{}))):(y({}),x([]));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[x,y]);var U=Object(o.useCallback)((function(e){e&&e._id&&(f(e.value)?C[e._id]=e:C[e._id]&&delete C[e._id],S(C)),z<=m.length&&A(z+1)}),[S,C,A,z,m.length]),L=Object(o.useCallback)((function(){z>-1&&A(z-1)}),[A,z]),J=Object(o.useCallback)((function(){z<=m.length&&(z<=0?A(z+1):m[z].input.required||A(z+1))}),[A,z,m]),M=Object(o.useCallback)((function(){A(-1)}),[A]),Y=Object(o.useCallback)((function(){A(0)}),[A]);O(["ArrowRight","ArrowLeft"],(function(e){"BODY"===e.target.nodeName&&("ArrowUp"===e.key||"ArrowLeft"===e.key?L():J())}));var Z=Object(o.useCallback)((function(){var e=Object.values(C).filter((function(e){return null!==e._id&&null!==e.value}));if(0===e.length)console.warn("\u26a0\ufe0f Keine Angaben. Unn\xf6tig abzusenden. But this if shoul'nt get called anyway.");else{var t=(e=e.reduce((function(e,t){var n=v[t._id],a=Object(i.a)(t.value);return!0===n.input.multiple?e[t._id]=a:e[t._id]=a[0],e}),{})).what_happened||"";delete e.what_happened,I({variables:{text:t,properties:e},ignoreResults:!1})}}),[C,v,I]),K=Object(o.useCallback)((function(){var e=Object.values(C).filter((function(e){return null!==e._id&&null!==e.value}));if(0===e.length)console.warn("\u26a0\ufe0f Keine Angaben. Unn\xf6tig runterzuladen. But this if shoul'nt get called anyway.");else{var t=(new Date).toISOString(),n=(t=t.replace(/T/g," ")).replace(/(:|\.)/g,"-");(function(e,t){var n=new Blob([e],{type:"text/plain"}),i=document.createElement("a");i.download=t,i.innerHTML="Download File",null!=window.webkitURL?i.href=window.webkitURL.createObjectURL(n):(i.href=window.URL.createObjectURL(n),i.onclick=function(){i.parentNode.removeChild(i)},i.style.display="none",document.body.appendChild(i)),i.click()})(e="# Dein Vorfall (".concat(t,")\n\n").concat(e.map((function(e){var t=v[e._id];return"## ".concat(t.question.de,"\n\n").concat(!0===t.input.multiple?Object(i.a)(e.value).map((function(e){return"- ".concat(T(e,t.input.options))})).join("\n"):T(Object(i.a)(e.value)[0],t.input.options))})).join("\n\n")),"Dein Vorfall ".concat(n,".md.txt"))}}),[C,v]);if(!m)return null;var $=m[z],P=Object.values(C).filter((function(e){return null!==e.value}));return Object(D.jsxs)("div",{className:h.a.survey,children:[Object(D.jsx)("div",{className:h.a.progress,style:{"--width":"".concat(z/m.length*100,"%"),opacity:z<=0?0:1}}),Object(D.jsx)("div",{className:h.a.content,children:Object(D.jsx)("div",{className:h.a.contentWrapper,children:-1===z?Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)("h3",{children:"Vorfall melden"}),Object(D.jsx)("p",{children:"Hier kannst du einen queerfeindlichen Vorfall melden."}),Object(D.jsx)("p",{children:"Deine Daten dienen lediglich zur statistischen Auswertung. Sie f\xfchren nicht zu einer Anzeige bei der Polizei. Wir speichern deine Daten anonymiesiert."}),Object(D.jsxs)("p",{children:["Bei Fragen kannst du dich an ",Object(D.jsx)("a",{href:"mailto:info@queerfeindlichkeit.de",target:"_blank",rel:"noreferrer",children:"info@queerfeindlichkeit.de"})," wenden. Oder uns bei Instagram eine Nachricht schichen: ",Object(D.jsx)("a",{href:"https://instagram.com/queerfeindlichkeit",target:"_blank",rel:"noreferrer",children:"@queerfeindlichkeit"})]}),Object(D.jsx)(j.a,{size:"default",onClick:Y,children:Object(D.jsx)(b.a,{id:"start_survey"})})]}):$?Object(D.jsx)(D.Fragment,{children:Object(D.jsx)(R,Object(r.a)({onSubmit:U,defaultValue:C[$._id]||null},$),$._id)}):0===P.length?Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)("h3",{children:"Hmmm\u2026"}),Object(D.jsx)("p",{children:"Du hast keine Angaben gemacht. Beschreib deinen Vorfall bitte etwas detailierter."}),Object(D.jsx)(j.a,{size:"default",onClick:M,children:Object(D.jsx)(b.a,{id:"back_to_beginning"})})]}):n?Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)("h3",{children:"Vielen Dank!"}),Object(D.jsx)("p",{children:"Dein Vorfall wurde hochgeladen."}),Object(D.jsx)("p",{children:Object(D.jsx)("strong",{children:"Vielen Dank, dass Du hilfst Queerfeindlichkeit sichtbar zu machen!"})}),Object(D.jsxs)("p",{children:["Du m\xf6chtest wissen, wie es weitergeht? Auf ",Object(D.jsx)("a",{href:"https://www.instagram.com/queerfeindlichkeit/",target:"_blank",rel:"noreferrer",children:"Instagram"})," und  ",Object(D.jsx)("a",{href:"https://twitter.com/anyway_koeln",target:"_blank",rel:"noreferrer",children:"Twitter"})," ver\xf6ffentlichen wir Daten und helfen dir gegen Queerfeindlichkeit anzukommen."]}),Object(D.jsx)("hr",{}),Object(D.jsx)("p",{children:"Hier kannst du dir noch Deine Daten abspeichern:"}),Object(D.jsx)(j.a,{size:"default",onClick:K,children:Object(D.jsx)(b.a,{id:"download_your_incident_data"})})]}):Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)("h3",{children:"Deine Angaben"}),Object(D.jsxs)("p",{children:["Hier kannst du nochmal \xfcber deine Angaben dr\xfcber schauen.",Object(D.jsx)("br",{}),"Geh gerne zur\xfcck um etwas zu koorigieren."]}),Object(D.jsxs)("p",{children:["Wenn du zufrieden bist, klick unten auf ",Object(D.jsx)("strong",{children:"\u201eVorfall eintragen\u201d"}),"."]}),Object(D.jsxs)("p",{children:["Deine Daten kannst du dir unter ",Object(D.jsx)("strong",{children:"\u201eDaten runterladen\u201d"}),"abspeichern."]}),Object(D.jsx)("hr",{}),P.map((function(e){var t=v[e._id];return Object(D.jsxs)("div",{children:[Object(D.jsx)("div",{className:"subtitle1",children:t.question.de}),!0===t.input.multiple?Object(D.jsx)("p",{children:Object(D.jsx)("ul",{children:Object(i.a)(e.value).map((function(e){return Object(D.jsx)("li",{children:T(e,t.input.options)})}))})}):T(Object(i.a)(e.value)[0],t.input.options).split("\n").map((function(e){return Object(D.jsx)("p",{children:e},e)}))]},e._id)})),Object(D.jsx)("hr",{}),Object(D.jsx)(j.a,{fill:"outline",size:"default",onClick:K,children:Object(D.jsx)(b.a,{id:"download_your_incident_data"})}),Object(D.jsx)(j.a,{size:"default",onClick:Z,children:Object(D.jsx)(b.a,{id:"submit_incident"})}),E&&Object(D.jsx)("p",{children:Object(D.jsx)(b.a,{id:"uploading"})}),W&&Object(D.jsx)("p",{children:Object(D.jsx)(b.a,{id:"error_while_uploading"})})]})})}),Object(D.jsxs)("div",{className:h.a.actions,children:[Object(D.jsx)(j.a,{disabled:z<=-1,fill:"outline",size:"default",onClick:L,children:Object(D.jsx)(b.a,{id:"prev"})}),Object(D.jsx)(j.a,{disabled:z>=m.length||!!$&&!!$.input&&$.input.required,fill:"outline",size:"default",onClick:J,children:Object(D.jsx)(b.a,{id:"next"})})]})]})}}}]);
//# sourceMappingURL=7.d3ecd5eb.chunk.js.map